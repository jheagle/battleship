"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}(function(){var e=this||{},t=e.gameUtils||{},r={};e.gameUtils=r,r.noConflict=function(){return e.gameUtils=t,r};var n=e.jsonDom;void 0===n&&("undefined"!=typeof require?n=require("json-dom"):console.error("functions.js requires json-dom")),r.checkIfShipCell=function(e,t){return t.children[e.z].children[e.y].children[e.x].hasShip},r.checkIfHitCell=function(e,t){return t.children[e.z].children[e.y].children[e.x].isHit},r.getAllNonHitCells=function(e){return n.jDomMatrixCore.getAllPoints(e).filter((function(t){return!r.checkIfHitCell(t,e)}))},r.getAdjEdgeNonHitCells=function(e,t){return n.jDomMatrixCore.adjacentEdgePoints(e,t).filter((function(e){return!r.checkIfHitCell(e,t)}))},r.getALowStatusItem=function(e){return e.reduce((function(e,t){return t.status<=e.status?t:e}))},r.getLowStatusItems=function(e){return e.filter((function(t){return t.status<=r.getALowStatusItem(e).status}))},r.getBrokenItems=function(e){return e.filter((function(e){return e.status<100&&e.status>0}))},r.getBrokenShipsPlayers=function(e){return e.filter((function(e){return r.getBrokenItems(e.shipFleet).length}))},r.numDamagedParts=function(e,t){return e-Math.ceil(t/100*e)},r.filterAdjacentPoints=function(e){return e.z%2==0&&(e.x%2==0&&e.y%2==0||e.x%2!=0&&e.y%2!=0)||e.z%2!=0&&(e.x%2!=0&&e.y%2==0||e.x%2==0&&e.y%2!=0)},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports=Object.assign(exports,r))}).call(window||{}),function(){var e=this||{},t=e.gameActions||{},r={};e.gameActions=r,r.noConflict=function(){return e.gameActions=t,r};var n=e.jsonDom;void 0===n&&("undefined"!=typeof require?n=require("json-dom"):console.error("actions.js requires json-dom"));var o=e.gameLayout;void 0===o&&("undefined"!=typeof require?o=require("./layout.js"):console.error("actions.js requires layout"));var i=e.gamePieces;void 0===i&&("undefined"!=typeof require?i=require("./pieces.js"):console.error("actions.js requires pieces"));var a=e.gameUtils;void 0===a&&("undefined"!=typeof require?a=require("./functions.js"):console.error("actions.js requires functions"));var u=function(e,t){return t?(r.attackFleet.isLocked=!0,n.functionalHelpers.queueTimeout((function(){return e.isHit&&(e.attributes.style.backgroundColor=e.hasShip?"red":"white"),e=n.jDomCore.updateElement(e),r.attackFleet.isLocked=!1,e}),0)):(e.isHit&&(e.attributes.style.backgroundColor=e.hasShip?"red":"white"),e=n.jDomCore.updateElement(e)),e},s=function(e,t,r,o,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return u(n.functionalHelpers.mergeObjectsMutable(t.children[i].children[o].children[r],e),a)},l=n.functionalHelpers.curry(s)(n.functionalHelpers.mergeObjects(i.shipTile(),{attributes:{style:{backgroundColor:"#777"}}})),c=n.functionalHelpers.curry(s)(i.shipTile()),m=n.functionalHelpers.curry(s)(i.hitTile());r.setShip=function(e,t,r){return r?l(e,t.x,t.y,t.z):c(e,t.x,t.y,t.z)};var f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(Math.round(100*e.status)/100,"%");return e.playerStats=n.jDomCore.updateElements(n.functionalHelpers.mergeObjects(e.playerStats,i.playerStats(e,t))),e};r.updatePlayer=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.attacker&&(t?++e.attacks.hit:++e.attacks.miss,o&&++e.attacks.sunk),t||(e.attacker=!e.attacker,r.attackFleet.isLocked=!0,e.attacker?(e.isRobot||n.functionalHelpers.queueTimeout((function(){return r.attackFleet.isLocked=!1,e.board.children.map((function(e){return e.children.map((function(e){return e.children.map((function(e){return n.jDomCore.updateElement(n.functionalHelpers.mergeObjects(e,{attributes:{style:{width:"17px",height:"17px"}}}))}))}))}))}),400),++e.turnCnt):n.functionalHelpers.queueTimeout((function(){return r.attackFleet.isLocked=!1,e.board.children.map((function(e){return e.children.map((function(e){return e.children.map((function(e){return n.jDomCore.updateElement(n.functionalHelpers.mergeObjects(e,{attributes:{style:{width:"35px",height:"35px"}}}))}))}))}))}),0));var i=n.functionalHelpers.queueTimeout((function(){return f(e,e.attacker?"ATTACKER":"".concat(Math.round(100*e.status)/100,"%"))}),0);return i.result||e};var d=function(e,t,i,a){var u=(a=a.filter((function(e){return e.status>0}))).reduce((function(e,t){return e.attacker?e:t}));if(u=r.updatePlayer(u,t,i),a.length<2)return n.functionalHelpers.queueTimeout((function(){return function(e){var t=n.jDomCore.getTopParentItem(e),r=e.parentItem.children;return r.map((function(e){return f(e)})),e=f(e,"WINNER"),n.jDomCore.renderHTML(o.finalScore(r),t).children[0].children.map((function(e){return e.attributes.innerHTML})),[n.functionalHelpers.trace("Winner")(e)]}(a[0])}),200);var s=function(e,t,n){return n?e:r.updatePlayer(function e(t,r,n){var o=r.length>1&&n>=r.length-1?r[0]:r[++n];return o.status>0?o:e(t,r,n)}(e,t,t.indexOf(e)),n)}(u,a,t);return s.isRobot&&n.functionalHelpers.queueTimeout(r.computerAttack,0,s,a),a};r.attackFleet=function(e){r.attackFleet.isLocked=r.attackFleet.isLocked||!1;var t=n.jDomCore.getParentsByClass("player",e)[0],o=n.jDomCore.getParentsByClass("boards",e)[0].children;if(t.status<=0||t.attacker||r.attackFleet.isLocked)return o;var i=m(t.board,e.point.x,e.point.y,e.point.z,o.reduce((function(e,t){return e.attacker?e:t})).isRobot),a=!1,u=0;if(i.hasShip){var s=0;t.shipFleet.map((function(t){var r=t.parts.filter((function(r){return n.jDomMatrixCore.areEqualPoints(r.point,e.point)&&(a=t),!r.isHit}));return t.status=r.length/t.parts.length*100,s+=t.status,t})),t.status=s/t.shipFleet.length}return a&&(t=f(t,"".concat(Math.round(100*t.status)/100,"%")),u=a.status<=0?a.parts.length:0),d(0,i.hasShip,u,o)},r.attackListener=function(e,t){return r.attackFleet(n.jDomMatrixCore.getDomItemFromElement(e.target,t))};var p=function(e,t,r){return[n.functionalHelpers.queueTimeout(h,0,{targets:e,victim:r}),n.functionalHelpers.queueTimeout(h,200,{targets:e,target:t,victim:r})]},h=function(e){return e.victim.board.children.map((function(e){return n.jDomCore.updateElement(n.functionalHelpers.mergeObjects(e,{attributes:{style:{borderColor:"#333"}}}))})),e.targets.forEach((function(t){return n.jDomCore.updateElement(n.functionalHelpers.mergeObjects(n.jDomMatrixCore.getDomItemFromPoint(t,e.victim.board),{attributes:{style:{borderColor:"#333"}}}))})),e.target||(e.victim.board.children.map((function(e){return n.jDomCore.updateElement(n.functionalHelpers.mergeObjects(e,{attributes:{style:{borderColor:"yellow"}}}))})),e.targets.forEach((function(t){return n.jDomCore.updateElement(n.functionalHelpers.mergeObjects(n.jDomMatrixCore.getDomItemFromPoint(t,e.victim.board),{attributes:{style:{borderColor:"yellow"}}}))}))),e};r.computerAttack=function(e,t){var o=function(e){var t=a.getBrokenShipsPlayers(e).length?a.getBrokenShipsPlayers(e):a.getLowStatusItems(e);return 1===t.length?t[0]:t[n.functionalHelpers.randomInteger(t.length)]}(t.filter((function(e){return!e.attacker})));return r.attackFleet.isLocked=!1,r.attackFleet(function(e){var t=a.getBrokenItems(e.shipFleet),r=[];if(t.length){var o=t.filter((function(e){return a.numDamagedParts(e.parts.length,e.status)>1})),i=a.getALowStatusItem(o.length?o:t).parts.filter((function(t){return a.checkIfHitCell(t.point,e.board)}));if(o.length){for(var u=0;u<i.length;++u){var s=n.jDomMatrixCore.testPointsBetween(i[0].point,i[u].point,e.board,a.checkIfHitCell,!1);if(s.false.length)return p(s.false,s.false[0],e),n.jDomMatrixCore.getDomItemFromPoint(s.false[0],e.board)}var l=(n.jDomMatrixCore.pointDifference(i[0].point,i[1].point).x>0?[n.jDomMatrixObjects.point(-1,0,0),n.jDomMatrixObjects.point(1,0,0)]:[n.jDomMatrixObjects.point(0,-1,0),n.jDomMatrixObjects.point(0,1,0)]).map((function(e,t){return n.jDomMatrixCore.nextCell(i[(i.length-1)*t].point,e)})).filter((function(t){return n.jDomMatrixCore.checkValidPoint(t,e.board)})).filter((function(t){return!a.checkIfHitCell(t,e.board)})),c=l.reduce((function(t,r){return a.checkIfHitCell(t,e.board)?r:t}));if(c)return p(l,c,e),n.jDomMatrixCore.getDomItemFromPoint(c,e.board)}r=a.getAdjEdgeNonHitCells(i[0].point,e.board)}var m=r.length?r:a.getAllNonHitCells(e.board).filter((function(e){return a.filterAdjacentPoints(e)})),f=m[n.functionalHelpers.randomInteger(m.length)];return p(m,f,e),n.jDomMatrixCore.getDomItemFromPoint(f,e.board)}(o))},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports=Object.assign(exports,r))}.call(window||{}),function(){var e=this||{},t=e.gameStart||{},r={};e.gameStart=r,r.noConflict=function(){return e.gameStart=t,r};var n=e.jsonDom;void 0===n&&("undefined"!=typeof require?n=require("json-dom"):console.error("setup.js requires json-dom"));var o=e.gameLayout;void 0===o&&("undefined"!=typeof require?o=require("./layout.js"):console.error("setup.js requires layout"));var i=e.gamePieces;void 0===i&&("undefined"!=typeof require?i=require("./pieces.js"):console.error("setup.js requires pieces"));var a=e.gameUtils;void 0===a&&("undefined"!=typeof require?a=require("./functions.js"):console.error("setup.js requires functions"));var u=e.gameActions;void 0===u&&("undefined"!=typeof require?u=require("./actions.js"):console.error("setup.js requires actions"));var s=function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return n.functionalHelpers.mergeObjects(i.ship(e.name),{parts:t.map((function(e){return u.setShip(r,e,o)}))})},l=function(e,t){return n.jDomMatrixCore.randDirection([n.jDomMatrixObjects.point(1,0,0),n.jDomMatrixObjects.point(0,1,0),n.jDomMatrixObjects.point(0,0,1)].filter((function(r){return e[n.jDomMatrixCore.getFirstAxisOfCoordinate(r,1)]>t})))},c=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l(e,t);return{start:n.jDomMatrixCore.randomStart(t,r,e),dir:r}},m=function e(t,r,o){var i,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c(o,r);return 0===n.jDomMatrixCore.getHighestAbsoluteCoordinate(u.dir)?[n.jDomMatrixObjects.point(0,0,0),n.jDomMatrixObjects.point(0,0,0)]:(i=n.jDomMatrixCore).checkInBetween.apply(i,[u.start,n.jDomMatrixCore.lineEndPoint(u.start,r,u.dir)].concat([t,a.checkIfShipCell]))?e(t,r,o):[u.start,n.jDomMatrixCore.lineEndPoint(u.start,r,u.dir)]},f=n.functionalHelpers.curry((function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.map((function(e){var o;return s(e,(o=n.jDomMatrixCore).getPointsLine.apply(o,_toConsumableArray(m(t,e.size,n.jDomMatrixCore.getAxisLengths(t)))),t,r)}))}))([{name:"Aircraft Carrier",size:5},{name:"Battleship",size:4},{name:"Submarine",size:3},{name:"Cruiser",size:3},{name:"Destroyer",size:2}]);r.beginRound=function(e,t){if(2!==e.eventPhase)return!1;console.log("beginRound",e.eventPhase,e.type),e.preventDefault();var r=n.jDomCore.getTopParentItem(t),a=parseInt(n.jDomCore.getChildrenByName("human-players",t)[0].element.value),s=parseInt(n.jDomCore.getChildrenByName("robot-players",t)[0].element.value);if(a<0||a>100||s<0||s>100)return!1;var l=n.jDomCore.getChildrenByName("first-go-first",t)[0].element.checked;0===(a=a<0?0:a)&&(s=s<2?2:s),1===a&&(s=s<1?1:s),n.jDomCore.removeChild(n.jDomCore.getChildrenByClass("main-menu",r.body)[0],r.body);var c=n.jDomCore.renderHTML(o.boards(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(t<1&&r<1)return o;var a=i.playerSet({},"Player ".concat(o.length+1));return a.isRobot=t<=0,a.board=n.jDomMatrixCore.bindPointData(n.jDomMatrixObjects.square({x:[i.waterTile(a,o)],matrixProps:[{eventListeners:{click:{listenerFunc:"attackListener",listenerArgs:{},listenerOptions:!1}}}]},10)),a.shipFleet=f(a.board,!1),a.playerStats=i.playerStats(a,"".concat(Math.round(100*a.status)/100,"%")),a.children=[a.board,a.playerStats],o.push(a),e(--t,t<0?--r:r,o)}(a,s)),r).children,m=u.updatePlayer(l?c[0]:c[n.functionalHelpers.randomInteger(c.length)]);return m.isRobot&&u.computerAttack(m,c),!1},r.main=function(e){for(var t=e.body.children.length-1;t>=0;--t)n.jDomCore.removeChild(e.body.children[t],e.body);return n.jDomCore.renderHTML(o.mainMenu(),e),e},r.restart=function(e,t){return r.main(n.jDomCore.getTopParentItem(t))},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports=Object.assign(exports,r))}.call(window||{});
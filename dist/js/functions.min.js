"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}(function(){var e=this||{},t=e.gameUtils||{},r={};e.gameUtils=r,r.noConflict=function(){return e.gameUtils=t,r};var n=e.jsonDom;void 0===n&&("undefined"!=typeof require?n=require("json-dom"):console.error("functions.js requires json-dom")),r.checkIfShipCell=function(e,t){return t.children[e.z].children[e.y].children[e.x].hasShip},r.checkIfHitCell=function(e,t){return t.children[e.z].children[e.y].children[e.x].isHit},r.getAllNonHitCells=function(e){return n.jDomMatrixCore.getAllPoints(e).filter((function(t){return!r.checkIfHitCell(t,e)}))},r.getAdjEdgeNonHitCells=function(e,t){return n.jDomMatrixCore.adjacentEdgePoints(e,t).filter((function(e){return!r.checkIfHitCell(e,t)}))},r.getALowStatusItem=function(e){return e.reduce((function(e,t){return t.status<=e.status?t:e}))},r.getLowStatusItems=function(e){return e.filter((function(t){return t.status<=r.getALowStatusItem(e).status}))},r.getBrokenItems=function(e){return e.filter((function(e){return e.status<100&&e.status>0}))},r.getBrokenShipsPlayers=function(e){return e.filter((function(e){return r.getBrokenItems(e.shipFleet).length}))},r.numDamagedParts=function(e,t){return e-Math.ceil(t/100*e)},r.filterAdjacentPoints=function(e){return e.z%2==0&&(e.x%2==0&&e.y%2==0||e.x%2!=0&&e.y%2!=0)||e.z%2!=0&&(e.x%2!=0&&e.y%2==0||e.x%2==0&&e.y%2!=0)},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports=Object.assign(exports,r))}).call(window||{}),function(){var e=this||{},t=e.gameActions||{},r={};e.gameActions=r,r.noConflict=function(){return e.gameActions=t,r};var n=e.functionalHelpers;void 0===n&&("undefined"!=typeof require?n=require("functional-helpers"):console.error("actions.js requires functional-helpers"));var o=e.jsonDom;void 0===o&&("undefined"!=typeof require?o=require("json-dom"):console.error("actions.js requires json-dom"));var i=e.gameLayout;void 0===i&&("undefined"!=typeof require?i=require("./layout.js"):console.error("actions.js requires layout"));var a=e.gamePieces;void 0===a&&("undefined"!=typeof require?a=require("./pieces.js"):console.error("actions.js requires pieces"));var u=e.gameUtils;void 0===u&&("undefined"!=typeof require?u=require("./functions.js"):console.error("actions.js requires functions"));var s=function(e,t){return t?(r.attackFleet.isLocked=!0,n.queueTimeout((function(){return e.isHit&&(e.attributes.style.backgroundColor=e.hasShip?"red":"white"),e=o.jDomCore.updateElement(e),r.attackFleet.isLocked=!1,e}),0)):(e.isHit&&(e.attributes.style.backgroundColor=e.hasShip?"red":"white"),e=o.jDomCore.updateElement(e)),e},c=function(e,t,r,o,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return s(n.mergeObjectsMutable(t.children[i].children[o].children[r],e),a)},l=n.curry(c)(n.mergeObjects(a.shipTile(),{attributes:{style:{backgroundColor:"#777"}}})),d=n.curry(c)(a.shipTile()),m=n.curry(c)(a.hitTile());r.setShip=function(e,t,r){return r?l(e,t.x,t.y,t.z):d(e,t.x,t.y,t.z)};var f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(Math.round(100*e.status)/100,"%");return e.playerStats=o.jDomCore.updateElements(n.mergeObjects(e.playerStats,a.playerStats(e,t))),e};r.updatePlayer=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.attacker&&(t?++e.attacks.hit:++e.attacks.miss,i&&++e.attacks.sunk),t||(e.attacker=!e.attacker,r.attackFleet.isLocked=!0,e.attacker?(e.isRobot||n.queueTimeout((function(){return r.attackFleet.isLocked=!1,e.board.children.map((function(e){return e.children.map((function(e){return e.children.map((function(e){return o.jDomCore.updateElement(n.mergeObjects(e,{attributes:{style:{width:"17px",height:"17px"}}}))}))}))}))}),400),++e.turnCnt):n.queueTimeout((function(){return r.attackFleet.isLocked=!1,e.board.children.map((function(e){return e.children.map((function(e){return e.children.map((function(e){return o.jDomCore.updateElement(n.mergeObjects(e,{attributes:{style:{width:"35px",height:"35px"}}}))}))}))}))}),0));var a=n.queueTimeout((function(){return f(e,e.attacker?"ATTACKER":"".concat(Math.round(100*e.status)/100,"%"))}),0);return a.result||e};var p=function(e,t,a,u){var s=(u=u.filter((function(e){return e.status>0}))).reduce((function(e,t){return e.attacker?e:t}));if(s=r.updatePlayer(s,t,a),u.length<2)return n.queueTimeout((function(){return function(e){var t=o.jDomCore.getTopParentItem(e),r=e.parentItem.children;return r.map((function(e){return f(e)})),e=f(e,"WINNER"),o.jDomCore.renderHTML(i.finalScore(r),t).children[0].children.map((function(e){return e.attributes.innerHTML})),console.log("Winner",e),[e]}(u[0])}),200);var c=function(e,t,n){return n?e:r.updatePlayer(function e(t,r,n){var o=r.length>1&&n>=r.length-1?r[0]:r[++n];return o.status>0?o:e(t,r,n)}(e,t,t.indexOf(e)),n)}(s,u,t);return c.isRobot&&n.queueTimeout(r.computerAttack,0,c,u),u};r.attackFleet=function(e){r.attackFleet.isLocked=r.attackFleet.isLocked||!1;var t=o.jDomCore.getParentsByClass("player",e)[0],n=o.jDomCore.getParentsByClass("boards",e)[0].children;if(t.status<=0||t.attacker||r.attackFleet.isLocked)return n;var i=m(t.board,e.point.x,e.point.y,e.point.z,n.reduce((function(e,t){return e.attacker?e:t})).isRobot),a=!1,u=0;if(i.hasShip){var s=0;t.shipFleet.map((function(t){var r=t.parts.filter((function(r){return o.jDomMatrixCore.areEqualPoints(r.point,e.point)&&(a=t),!r.isHit}));return t.status=r.length/t.parts.length*100,s+=t.status,t})),t.status=s/t.shipFleet.length}return a&&(t=f(t,"".concat(Math.round(100*t.status)/100,"%")),u=a.status<=0?a.parts.length:0),p(0,i.hasShip,u,n)},r.attackListener=function(e,t){return r.attackFleet(o.jDomMatrixCore.getDomItemFromElement(e.target,t))};var h=function(e,t,r){return[n.queueTimeout(g,0,{targets:e,victim:r}),n.queueTimeout(g,200,{targets:e,target:t,victim:r})]},g=function(e){return e.victim.board.children.map((function(e){return o.jDomCore.updateElement(n.mergeObjects(e,{attributes:{style:{borderColor:"#333"}}}))})),e.targets.forEach((function(t){return o.jDomCore.updateElement(n.mergeObjects(o.jDomMatrixCore.getDomItemFromPoint(t,e.victim.board),{attributes:{style:{borderColor:"#333"}}}))})),e.target||(e.victim.board.children.map((function(e){return o.jDomCore.updateElement(n.mergeObjects(e,{attributes:{style:{borderColor:"yellow"}}}))})),e.targets.forEach((function(t){return o.jDomCore.updateElement(n.mergeObjects(o.jDomMatrixCore.getDomItemFromPoint(t,e.victim.board),{attributes:{style:{borderColor:"yellow"}}}))}))),e};r.computerAttack=function(e,t){var i=function(e){var t=u.getBrokenShipsPlayers(e).length?u.getBrokenShipsPlayers(e):u.getLowStatusItems(e);return 1===t.length?t[0]:t[n.randomInteger(t.length)]}(t.filter((function(e){return!e.attacker})));return r.attackFleet.isLocked=!1,r.attackFleet(function(e){var t=u.getBrokenItems(e.shipFleet),r=[];if(t.length){var i=t.filter((function(e){return u.numDamagedParts(e.parts.length,e.status)>1})),a=u.getALowStatusItem(i.length?i:t).parts.filter((function(t){return u.checkIfHitCell(t.point,e.board)}));if(i.length){for(var s=0;s<a.length;++s){var c=o.jDomMatrixCore.testPointsBetween(a[0].point,a[s].point,e.board,u.checkIfHitCell,!1);if(c.false.length)return h(c.false,c.false[0],e),o.jDomMatrixCore.getDomItemFromPoint(c.false[0],e.board)}var l=(o.jDomMatrixCore.pointDifference(a[0].point,a[1].point).x>0?[o.jDomMatrixObjects.point(-1,0,0),o.jDomMatrixObjects.point(1,0,0)]:[o.jDomMatrixObjects.point(0,-1,0),o.jDomMatrixObjects.point(0,1,0)]).map((function(e,t){return o.jDomMatrixCore.nextCell(a[(a.length-1)*t].point,e)})).filter((function(t){return o.jDomMatrixCore.checkValidPoint(t,e.board)})).filter((function(t){return!u.checkIfHitCell(t,e.board)})),d=l.reduce((function(t,r){return u.checkIfHitCell(t,e.board)?r:t}));if(d)return h(l,d,e),o.jDomMatrixCore.getDomItemFromPoint(d,e.board)}r=u.getAdjEdgeNonHitCells(a[0].point,e.board)}var m=r.length?r:u.getAllNonHitCells(e.board).filter((function(e){return u.filterAdjacentPoints(e)})),f=m[n.randomInteger(m.length)];return h(m,f,e),o.jDomMatrixCore.getDomItemFromPoint(f,e.board)}(i))},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports=Object.assign(exports,r))}.call(window||{}),function(){var e=this||{},t=e.gameStart||{},r={};e.gameStart=r,r.noConflict=function(){return e.gameStart=t,r};var n=e.functionalHelpers;void 0===n&&("undefined"!=typeof require?n=require("functional-helpers"):console.error("actions.js requires functional-helpers"));var o=e.jsonDom;void 0===o&&("undefined"!=typeof require?o=require("json-dom"):console.error("setup.js requires json-dom"));var i=e.gameLayout;void 0===i&&("undefined"!=typeof require?i=require("./layout.js"):console.error("setup.js requires layout"));var a=e.gamePieces;void 0===a&&("undefined"!=typeof require?a=require("./pieces.js"):console.error("setup.js requires pieces"));var u=e.gameUtils;void 0===u&&("undefined"!=typeof require?u=require("./functions.js"):console.error("setup.js requires functions"));var s=e.gameActions;void 0===s&&("undefined"!=typeof require?s=require("./actions.js"):console.error("setup.js requires actions"));var c=function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return n.mergeObjects(a.ship(e.name),{parts:t.map((function(e){return s.setShip(r,e,o)}))})},l=function(e,t){return o.jDomMatrixCore.randDirection([o.jDomMatrixObjects.point(1,0,0),o.jDomMatrixObjects.point(0,1,0),o.jDomMatrixObjects.point(0,0,1)].filter((function(r){return e[o.jDomMatrixCore.getFirstAxisOfCoordinate(r,1)]>t})))},d=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l(e,t);return{start:o.jDomMatrixCore.randomStart(t,r,e),dir:r}},m=function e(t,r,n){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d(n,r);return 0===o.jDomMatrixCore.getHighestAbsoluteCoordinate(a.dir)?[o.jDomMatrixObjects.point(0,0,0),o.jDomMatrixObjects.point(0,0,0)]:(i=o.jDomMatrixCore).checkInBetween.apply(i,[a.start,o.jDomMatrixCore.lineEndPoint(a.start,r,a.dir)].concat([t,u.checkIfShipCell]))?e(t,r,n):[a.start,o.jDomMatrixCore.lineEndPoint(a.start,r,a.dir)]},f=n.curry((function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.map((function(e){var n;return c(e,(n=o.jDomMatrixCore).getPointsLine.apply(n,_toConsumableArray(m(t,e.size,o.jDomMatrixCore.getAxisLengths(t)))),t,r)}))}))([{name:"Aircraft Carrier",size:5},{name:"Battleship",size:4},{name:"Submarine",size:3},{name:"Cruiser",size:3},{name:"Destroyer",size:2}]);r.beginRound=function(e,t){if(2!==e.eventPhase)return!1;console.log("beginRound",e.eventPhase,e.type),e.preventDefault();var r=o.jDomCore.getTopParentItem(t),u=parseInt(o.jDomCore.getChildrenByName("human-players",t)[0].element.value),c=parseInt(o.jDomCore.getChildrenByName("robot-players",t)[0].element.value);if(u<0||u>100||c<0||c>100)return!1;var l=o.jDomCore.getChildrenByName("first-go-first",t)[0].element.checked;0===(u=u<0?0:u)&&(c=c<2?2:c),1===u&&(c=c<1?1:c),o.jDomCore.removeChild(o.jDomCore.getChildrenByClass("main-menu",r.body)[0],r.body);var d=o.jDomCore.renderHTML(i.boards(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(t<1&&r<1)return n;var i=a.playerSet({},"Player ".concat(n.length+1));return i.isRobot=t<=0,i.board=o.jDomMatrixCore.bindPointData(o.jDomMatrixObjects.square({x:[a.waterTile(i,n)],matrixProps:[{eventListeners:{click:{listenerFunc:"attackListener",listenerArgs:{},listenerOptions:!1}}}]},10)),i.shipFleet=f(i.board,!1),i.playerStats=a.playerStats(i,"".concat(Math.round(100*i.status)/100,"%")),i.children=[i.board,i.playerStats],n.push(i),e(--t,t<0?--r:r,n)}(u,c)),r).children,m=s.updatePlayer(l?d[0]:d[n.randomInteger(d.length)]);return m.isRobot&&s.computerAttack(m,d),!1},r.main=function(e){for(var t=e.body.children.length-1;t>=0;--t)o.jDomCore.removeChild(e.body.children[t],e.body);return o.jDomCore.renderHTML(i.mainMenu(),e),e},r.restart=function(e,t){return r.main(o.jDomCore.getTopParentItem(t))},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports=Object.assign(exports,r))}.call(window||{});
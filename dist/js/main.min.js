"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},curry=function(e){return function t(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return r.length>=e.length?e.apply(void 0,r):function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.apply(void 0,[].concat(r,n))}}},cloneObject=function(e){return cloneExclusions(JSON.parse(JSON.stringify(e)),e)},cloneExclusions=function e(t,n){return"object"===(void 0===n?"undefined":_typeof(n))&&Object.keys(n).length?(Object.keys(n).map(function(r){return t[r]=!t[r]||n[r]instanceof HTMLElement?n[r]:e(t[r],n[r])}),t):Array.isArray(n)&&n.length?(n.map(function(n,r){return t[r]=!t[r].length||n instanceof HTMLElement?n:e(t[r],n)}),t):t},mergeObjects=function e(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if(1===n.length)return n[0];if(n.length>2)return n.reduce(function(t,n){return e(t,n)},{});var i=n[0],a=n[1];return"object"===(void 0===a?"undefined":_typeof(a))&&Object.keys(a).length?(Object.keys(a).map(function(t){return i[t]=!i[t]||a[t]instanceof HTMLElement?a[t]:e(i[t],a[t])}),i):Array.isArray(a)&&a.length?(a.map(function(t,n){return i[n]=!i[n].length||t instanceof HTMLElement?t:e(i[n],t)}),i):"object"===(void 0===a?"undefined":_typeof(a))||Array.isArray(a)?Object.assign(i,a):a},fillArray=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return(r=r.slice()).push(t),--n>0?e(cloneObject(t),n,r):r},buildArray=curry(fillArray),nextIndex=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t<e.length-1?++t:e.length-1},nextCell=function(e,t){return point(e.x+t.x,e.y+t.y,e.z+t.z)},pointDifference=function(e,t){return point(t.x-e.x,t.y-e.y,t.z-e.z)},checkEqualPoints=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z},bindPointData=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(n).length||(n=point(0,0,0)),t.point?t.point=cloneObject(n):t.children.map(function(t,r){return n=mergeObjects(n,_defineProperty({},t.axis,r)),e(t,n)}),t},getChildrenFromAttribute=function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return t.attributes[n]&&t.attributes[n]===r&&i.push(t),t.children.map(function(t){return e(t,n,r,i)}),i},addElementStyles=function(e,t){return Object.keys(t).length&&e.style&&Object.keys(t).forEach(function(n){return e.style[n]=t[n]}),e},generateElement=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement(e.element);return Object.keys(e).map(function(t){"element"!==t&&"styles"!==t&&n.setAttribute(t,e[t])}),Object.keys(t).map(function(e){n[e]=t[e]}),e.styles&&addElementStyles(n,e.styles),n},bindElements=function e(t){return DOMItem(t,{attributes:t.attributes,elementProperties:t.elementProperties,element:generateElement(t.attributes,t.elementProperties),children:t.children.map(e)})},buildHTML=function e(t){return t.children.map(function(n){return t.element.appendChild(e(n))}),t.element},appendHTML=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:documentItem.body;return Array.isArray(e)?e.map(function(e){return t.children.push(e)}):t.children.push(e),buildHTML(t),e},removeChild=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:documentItem.body;return t.element.removeChild(e.element),t.children.splice(t.children.indexOf(e),1)},testPointsBetween=function(e,t,n,r){var i={true:[],false:[]},a=pointDifference(e,t);if(a.x>1)for(var o=e.x;o<t.x;++o){var u=point(o,e.y,e.z);r(u,n)?i.true.push(u):i.false.push(u)}else if(a.y>1)for(var l=e.y;l<t.y;++l){var c=point(e.x,l,e.z);r(c,n)?i.true.push(c):i.false.push(c)}else if(a.z>1)for(var s=e.z;s<t.z;++s){var d=point(e.x,e.y,s);r(d,n)?i.true.push(d):i.false.push(d)}return i},getInBetween=function(e,t,n,r){var i={true:[],false:[]};return(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&(r(e,n)?i.true.push(e):i.false.push(e),r(t,n)?i.true.push(t):i.false.push(t)),mergeObjects(i,testPointsBetween(e,t,n,r))},checkInBetween=function(e,t,n,r){return!(!(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])||!r(e,n)&&!r(t,n))||!!testPointsBetween(e,t,n,r).true.length},getAxisLengths=function(e){return{x:e.children[0].children[0].children.length,y:e.children[0].children.length,z:e.children.length}},randCoords=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.floor(Math.random()*(e-(t-1)*n))},randDirection=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(Math.floor(Math.random()*(2+e))){case 0:return point(1,0,0);case 1:return point(0,1,0);default:return point(0,0,1)}},checkValidPoint=function(e,t){return!!(t.children[e.z]&&t.children[e.z].children[e.y]&&t.children[e.z].children[e.y].children[e.x]&&t.children[e.z].children[e.y].children[e.x].point)},getDOMItemFromPoint=function(e,t){return!!checkValidPoint(e,t)&&t.children[e.z].children[e.y].children[e.x]},getAllPoints=function(e){for(var t=getAxisLengths(e),n=[],r=0;r<t.z;++r)for(var i=0;i<t.y;++i)for(var a=0;a<t.x;++a)n.push(e.children[r].children[i].children[a].point);return n},adjacentPoints=function(e,t){for(var n=[],r=-1;r<2;++r)for(var i=-1;i<2;++i)for(var a=-1;a<2;++a){var o=point(e.x+a,e.y+i,e.z+r);checkValidPoint(o,t)&&point!==o&&n.push(o)}return n},adjacentEdgePoints=function(e,t){return[point(-1,0,0),point(1,0,0),point(0,-1,0),point(0,1,0),point(0,0,-1),point(0,0,1)].map(function(t){return point(e.x+t.x,e.y+t.y,e.z+t.z)}).filter(function(e){return checkValidPoint(e,t)})},bindListeners=function e(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.eventListeners&&Object.keys(t.eventListeners).length&&t.element instanceof HTMLElement?Object.keys(t.eventListeners).map(function(e){return t.element.addEventListener(e,function(n){var i;return(i=t.eventListeners)[e].apply(i,[n,t].concat(r))})}):t.children.map(function(t){return e.apply(void 0,[t].concat(r))}),t},queueTimeout=function e(){for(var t=arguments.length,n=Array(t>2?t-2:0),r=2;r<t;r++)n[r-2]=arguments[r];var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.queue=e.queue||[],e.isRunning=e.isRunning||!1,i&&e.queue.push({func:i,timeout:a,args:n}),e.queue.length&&!e.isRunning){e.isRunning=!0;var o=e.queue.shift();return o.args=o.args||[],setTimeout(function(){return o.func.apply(o,_toConsumableArray(o.args)),e.isRunning=!1,e(!1)},o.timeout)}return e.isRunning},mainMenu=function(){return DOMItem({attributes:{class:"main-menu"},children:[DOMItem({attributes:{class:"content"},children:[DOMItem({attributes:{element:"form",class:"main-menu-form"},children:[DOMItem({attributes:{class:"form-group"},children:[DOMItem({attributes:{element:"label",for:"human-players"},elementProperties:{innerText:"Humans"}}),DOMItem({attributes:{element:"input",id:"human-players",name:"human-players",type:"number",value:0,min:0,max:100}})]}),DOMItem({attributes:{class:"form-group"},children:[DOMItem({attributes:{element:"label",for:"robot-players"},elementProperties:{innerText:"Robots"}}),DOMItem({attributes:{element:"input",id:"robot-players",name:"robot-players",type:"number",value:0,min:0,max:100}})]}),DOMItem({attributes:{element:"label",for:"first-go-first"},elementProperties:{innerText:"First Player Starts"}}),DOMItem({attributes:{element:"input",id:"first-go-first",name:"first-go-first",type:"checkbox"}}),DOMItem({attributes:{element:"input",type:"submit",value:"Start"}})]})]})]})},boards=function(){return DOMItem({attributes:{class:"boards"}})},checkIfShipCell=function(e,t){return t.children[e.z].children[e.y].children[e.x].hasShip},checkIfHitCell=function(e,t){return t.children[e.z].children[e.y].children[e.x].isHit},getAllNonHitCells=function(e){return getAllPoints(e).filter(function(t){return!checkIfHitCell(t,e)})},getAdjNonHitCells=function(e,t){return adjacentPoints(e,t).filter(function(e){return!checkIfHitCell(e,t)})},getAdjEdgeNonHitCells=function(e,t){return adjacentEdgePoints(e,t).filter(function(e){return!checkIfHitCell(e,t)})},getALowStatusItem=function(e){return e.reduce(function(e,t){return t.status<=e.status?t:e})},getLowStatusItems=function(e){return e.filter(function(t){return t.status<=getALowStatusItem(e).status})},getBrokenItems=function(e){return e.filter(function(e){return e.status<100&&e.status>0})},getBrokenShipsPlayers=function(e){return e.filter(function(e){return getBrokenItems(e.shipFleet).length})},numDamangedParts=function(e,t){return e-Math.ceil(t/100*e)},filterAdjacentPoints=function(e){return e.z%2==0&&(e.x%2==0&&e.y%2==0||e.x%2!=0&&e.y%2!=0)||e.z%2!=0&&(e.x%2!=0&&e.y%2==0||e.x%2==0&&e.y%2!=0)},buildShip=function(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=ship(),o=t,u=0;u<e;++u)a.parts.push(setShip(r,o,i)),o=nextCell(o,n);return a},generateStartDir=function e(t,n,r,i){var a=randDirection(i),o=point(randCoords(r.x,n,a.x),randCoords(r.y,n,a.y),randCoords(r.z,n,a.z)),u=point(o.x+a.x*(n-1),o.y+a.y*(n-1),o.z+a.z*(n-1));return checkInBetween(o,u,t,checkIfShipCell)?e(t,n,r,i):{start:o,dir:a}},generateRandomFleet=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=getAxisLengths(t);for(var a in e){point(0,0,0),point(0,0,0);var o=e[a]<=i.z?1:0,u=generateStartDir(t,e[a],i,o);r.push(buildShip(e[a],u.start,u.dir,t,n))}return r},randomFleet=curry(generateRandomFleet),DOMItem=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return mergeObjects.apply(void 0,[{attributes:{element:"div",styles:{}},elementProperties:{},element:{},eventListeners:{},children:[]}].concat(t))},documentDOMItem=function(){var e=[DOMItem({attributes:{element:"head"},element:document.head,children:[]}),DOMItem({attributes:{element:"body"},element:document.body,children:[]})];return DOMItem({attributes:{element:"html"},element:document,children:e,head:e[0],body:e[1]})},documentItem=documentDOMItem(),point=function(e,t){return{x:e,y:t,z:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0}},tile=function(){return{point:{}}},coordinate=function(e){return{axis:e}},matrix=function(e,t,n){for(var r=arguments.length,i=Array(r>4?r-4:0),a=4;a<r;a++)i[a-4]=arguments[a];var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return DOMItem({attributes:{class:"matrix"},children:buildArray(DOMItem.apply(void 0,[coordinate("z"),{attributes:{class:"layer"},children:buildArray(DOMItem.apply(void 0,[coordinate("y"),{attributes:{class:"row"},children:buildArray(DOMItem.apply(void 0,[coordinate("x"),{attributes:{class:"column"}}].concat(i,[e])),t)}].concat(i)),n)}].concat(i)),o)})},square=function(e,t){return matrix(e,t,t)},cube=function(e,t){return matrix(e,t,t,t)},tableHTML=function(){return{base:[{element:"table",class:"matrix"}],z:{element:"tbody"},y:{element:"tr",class:"row"},x:{element:"td",class:"column"}}},gameTile=function(){return{hasShip:!1,isHit:!1,eventListeners:{click:attackListener}}},waterTile=function(){return mergeObjects(gameTile(),tile())},shipTile=function(){return{hasShip:!0}},ship=function(){return{status:100,parts:[]}},hitTile=function(){return{isHit:!0}},playerSet=function(){return{name:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",isRobot:!1,status:100,turnCnt:0,attacker:!1,attacks:{hit:0,miss:0,sunk:0},shipFleet:[]}},defaultFleet=randomFleet([5,4,3,3,2]),selectTargetPlayer=function(e){var t=getBrokenShipsPlayers(e).length?getBrokenShipsPlayers(e):getLowStatusItems(e);return 1===t.length?t[0]:t[Math.floor(Math.random()*t.length)]},selectTargetCoord=function(e){var t=getBrokenItems(e.shipFleet),n=[];if(t.length){var r=t.filter(function(e){return numDamangedParts(e.parts.length,e.status)>1}),i=getALowStatusItem(r.length?r:t).parts.filter(function(t){return checkIfHitCell(t.point,e)});if(r.length){for(var a=0;a<i.length;++a){var o=getInBetween(i[0].point,i[a].point,e,checkIfHitCell,!1);if(o.false.length)return displayTargets(o.false,o.false[0],e),o.false[0]}var u=(pointDifference(i[0].point,i[1].point).x>0?[point(-1,0,0),point(1,0,0)]:[point(0,-1,0),point(0,1,0)]).map(function(e,t){return nextCell(i[(i.length-1)*t].point,e)}).filter(function(t){return checkValidPoint(t,e)}).filter(function(t){return!checkIfHitCell(t,e)}),l=u.reduce(function(t,n){return checkIfHitCell(t,e)?n:t});if(l)return displayTargets(u,l,e),l}n=getAdjEdgeNonHitCells(i[0].point,e)}var c=n.length?n:getAllNonHitCells(e).filter(function(e){return filterAdjacentPoints(e)}),s=c[Math.floor(Math.random()*c.length)];return displayTargets(c,s,e),s},displayTargets=function(e,t,n){return[queueTimeout(resetTargets,0,{targets:e,victim:n}),queueTimeout(resetTargets,400,{targets:e,target:t,victim:n})]},resetTargets=function(e){return e.victim.children.map(function(e){return addElementStyles(e.element,{borderColor:"#333"})}),e.targets.forEach(function(t){return addElementStyles(getDOMItemFromPoint(t,e.victim).element,{borderColor:"#333"})}),e.target?setHit(e.victim,e.target.x,e.target.y,e.target.z,e.victim.isRobot):(e.victim.children.map(function(e){return addElementStyles(e.element,{borderColor:"yellow"})}),e.targets.forEach(function(t){return addElementStyles(getDOMItemFromPoint(t,e.victim).element,{borderColor:"yellow"})}))},computerAttack=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=selectTargetPlayer(t.filter(function(e){return!e.attacker}));attackFleet.isLocked=!1,attackFleet(selectTargetCoord(r,n),r,t)},configureHtml=function(e,t){return e.isHit&&(e.attributes.styles.backgroundColor=e.hasShip?"red":"white"),t?(attackFleet.isLocked=!0,queueTimeout(function(){return e.element=addElementStyles(e.element,e.attributes.styles),attackFleet.isLocked=!1,e},0)):e.element=addElementStyles(e.element,e.attributes.styles),e},update3dCell=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return configureHtml(mergeObjects(t.children[i].children[r].children[n],e),a)},alter3dCell=curry(update3dCell),setViewShip=alter3dCell(mergeObjects(shipTile(),{attributes:{styles:{backgroundColor:"#777"}}})),setHiddenShip=alter3dCell(shipTile()),setShip=function(e,t,n){return n?setViewShip(e,t.x,t.y,t.z):setHiddenShip(e,t.x,t.y,t.z)},setHit=alter3dCell(hitTile()),updatePlayer=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.attacker&&(t?++e.attacks.hit:++e.attacks.miss,n&&++e.attacks.sunk),t||(e.attacker=!e.attacker,attackFleet.isLocked=!0,e.attacker?(queueTimeout(function(){e.element=addElementStyles(e.element,{fontSize:"0.5rem"}),e.children.map(function(e){return e.children.map(function(e){return e.children.map(function(e){return addElementStyles(e.element,{width:"17.5px",height:"17.5px"})})})}),attackFleet.isLocked=!1},400),++e.turnCnt):(e.element=addElementStyles(e.element,{fontSize:"1rem"}),queueTimeout(function(){e.children.map(function(e){return e.children.map(function(e){return e.children.map(function(e){return addElementStyles(e.element,{width:"35px",height:"35px"})})})}),attackFleet.isLocked=!1},0))),e},endGame=function(e){return[e]},findNextAttacker=function e(t,n,r){var i=n.length>1&&r>=n.length-1?n[0]:n[++r];return i.status>0?i:e(t,n,r)},getNextAttacker=function(e,t,n){var r=t.indexOf(e),i=findNextAttacker(e,t.filter(function(e){return e.status>0}),r);return n?e:updatePlayer(i,n)},updateScore=function(e,t,n,r,i){var a=(r=r.filter(function(e){return e.status>0})).reduce(function(e,t){return e.attacker?e:t});if(a=updatePlayer(a,t,n),r.length<2)return endGame(r[0]);var o=getNextAttacker(a,r,t);return o.isRobot&&queueTimeout(computerAttack,0,o,r,!!t&&i),r},attackFleet=function e(t,n,r){if(e.isLocked=e.isLocked||!1,n.status<=0||n.attacker||e.isLocked)return r;var i=setHit(n,t.x,t.y,t.z,r.reduce(function(e,t){return e.attacker?e:t}).isRobot),a=!1,o=0;if(i.hasShip){var u=0;n.shipFleet.map(function(e){var n=e.parts.filter(function(n){return checkEqualPoints(n.point,t)&&(a=e),!n.isHit});return e.status=n.length/e.parts.length*100,u+=e.status,e}),n.status=u/n.shipFleet.length}return a&&(o=a.status<=0?a.parts.length:0),updateScore(n,i.hasShip,o,r,t)},launchAttack=curry(attackFleet),attackListener=function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return attackFleet.apply(void 0,[t.point].concat(r))};!function(){var e=documentDOMItem(),t=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(t<1&&n<1)return r;var i=bindListeners.apply(void 0,_toConsumableArray(buildArray(bindElements(bindPointData(mergeObjects(playerSet(),{isRobot:t<=0},square(waterTile(),10)))),2)).concat([r]));return i.shipFleet=defaultFleet(i),r.push(i),e(--t,t<0?--n:n,r)},n=function(n,r){n.preventDefault();var i=parseInt(getChildrenFromAttribute(r,"name","human-players")[0].element.value),a=parseInt(getChildrenFromAttribute(r,"name","robot-players")[0].element.value),o=getChildrenFromAttribute(r,"name","first-go-first")[0].element.checked;0===(i=i<0?0:i)&&(a=a<2?2:a),1===i&&(a=a<1?1:a),removeChild(getChildrenFromAttribute(e.body,"class","main-menu")[0]);var u=t(i,a);appendHTML(u,appendHTML(bindElements(boards())));var l=updatePlayer(o?u[0]:u[Math.floor(Math.random()*u.length)]);return l.isRobot&&computerAttack(l,u,!1),!1};!function(){var t=bindElements(mainMenu());bindListeners(mergeObjects(getChildrenFromAttribute(t,"class","main-menu-form")[0],{eventListeners:{submit:n}})),appendHTML(t,e.body)}(),console.log(e)}();
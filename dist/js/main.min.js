"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},curry=function(e){return function t(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return n.length>=e.length?e.apply(void 0,n):function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return t.apply(void 0,[].concat(n,r))}}},cloneObject=function(e){return JSON.parse(JSON.stringify(e))},mergeObjects=function e(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];for(var i=r[0],a=r[1];r.length>2;){var l=r.splice(r.length-2,2);a=r[r.length-2]=e.apply(void 0,_toConsumableArray(l))}return"object"!==("undefined"==typeof i?"undefined":_typeof(i))||"object"!==("undefined"==typeof a?"undefined":_typeof(a))?"object"===("undefined"==typeof a?"undefined":_typeof(a))?a:i:(Object.keys(a).map(function(t){"object"===_typeof(a[t])&&i.hasOwnProperty(t)&&"object"===_typeof(i[t])&&(i[t]=e(i[t],a[t]),Object.keys(i[t]).length>Object.keys(a[t]).length&&(a[t]=cloneObject(i[t])))}),Object.assign(i,a))},fillArray=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return n=n.slice(),n.push(t),--r>0?e(cloneObject(t),r,n):n},buildArray=curry(fillArray),nextIndex=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t<e.length-1?++t:e.length-1},nextCell=function(e,t){return{x:e.x+t.x,y:e.y+t.y,z:e.z+t.z}},locateCells=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object.keys(r).length||(r=point(0,0,0)),Array.isArray(t)?t.map(function(t,i){switch(n){case 0:r=mergeObjects(r,{z:i});break;case 1:r=mergeObjects(r,{y:i});break;default:r=mergeObjects(r,{x:i})}return e(t,r,n+1)}):(t.point=cloneObject(r),t)},checkIfShipCell=function(e,t){return t[e.z][e.y][e.x].hasShip},checkIfAnyShip=function(e,t){return e.filter(function(e){return!checkIfShipCell(e,t)})},checkShipBetween=function(e,t,r){if(checkIfShipCell(e,r)||checkIfShipCell(t,r))return!0;var n=t.x-e.x,i=t.y-e.y,a=t.z-e.z;if(n>0){for(var l=e.x;l<t.x;++l)if(checkIfShipCell({x:l,y:e.y,z:e.z},r))return!0}else if(i>0){for(var o=e.y;o<t.y;++o)if(checkIfShipCell({x:e.x,y:o,z:e.z},r))return!0}else if(a>0)for(var u=e.z;u<t.z;++u)if(checkIfShipCell({x:e.x,y:e.y,z:u},r))return!0;return!1},buildShip=function(e,t,r,n){for(var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=ship(),l=t,o=0;o<e;++o)a.parts.push(setShip(n,l,i)),l=nextCell(l,r);return a},buildFleet=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[];for(var i in e){var a=point(0,0,0),l=0,o=point(1,0,0),u=point(0,0,0);do{switch(l=Math.floor(Math.random()*(t.length+1))){case 1:o=point(0,1,0);break;case 2:o=point(0,1,0)}a=point(Math.floor(Math.random()*(t[0][0].length-(e[i]-1)*o.x)),Math.floor(Math.random()*(t[0].length-(e[i]-1)*o.y)),Math.floor(Math.random()*(t.length-(e[i]-1)*o.z))),u=point(a.x+o.x*(e[i]-1),a.y+o.y*(e[i]-1),a.z+o.z*(e[i]-1))}while(checkShipBetween(a,u,t));n.push(buildShip(e[i],a,o,t,r))}return n},fleetBuilder=curry(buildFleet),bindListeners=function e(t,r,n){for(var i=arguments.length,a=Array(i>3?i-3:0),l=3;l<i;l++)a[l-3]=arguments[l];return Array.isArray(t)?t.map(function(t){return e.apply(void 0,[t,r,n].concat(a))}):t.element instanceof HTMLElement?t.element.addEventListener("click",function(){return r.apply(void 0,[n,t.point].concat(a))}):t.element},point=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:e,y:t,z:r}},shipViewTile=function(){return{hasShip:!0,styles:{backgroundColor:"#777"}}},tile=function(){return{point:{},styles:{width:"35px",height:"35px",backgroundColor:"transparent"},element:{}}},rectMatrix=function(e,t,r){return buildArray(buildArray(e,t),r)},rect3d=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return buildArray(rectMatrix(e,t,r),n)},squareMatrix=function(e,t){return rectMatrix(e,t,t)},cube3d=function(e,t){return rect3d(e,t,t,t)},tableHTML=function(){return[[{type:"table",class:"matrix"},{type:"tbody"}],{type:"tr",class:"row"},{type:"td",class:"column"}]},gameTile=function(){return{hasShip:!1,isHit:!1,styles:{border:"1px solid #333",backgroundColor:"white",cursor:"pointer"}}},waterTile=function(){return mergeObjects(tile(),gameTile(),{styles:{backgroundColor:"blue"}})},shipTile=function(){return{hasShip:!0}},ship=function(){return{status:100,parts:[]}},hitTile=function(){return{isHit:!0}},boardHTML=function(){return[[{type:"div",class:"matrix",styles:{display:"inline-block",position:"relative",width:"50%",margin:"0 auto"}}],{type:"div",class:"layer",styles:{display:"inline-block",position:"relative",margin:"0 auto"}},{type:"div",class:"row",styles:{display:"flex"}},{type:"div",class:"column",styles:{display:"inline-block"}}]},playerSet=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{name:e,status:100,turnCnt:0,attacker:!1,attacks:{hit:0,miss:0,sunk:0},board:{},shipFleet:[]}},defaultFleet=fleetBuilder([5,4,3,3,2]),configureHtml=function(e){return e.isHit&&(e.styles.backgroundColor=e.hasShip?"red":"white"),addElementStyles(e.element,e.styles),e},addElementStyles=function(e,t){return Object.keys(t).length&&e.style?Object.keys(t).forEach(function(r){return e.style[r]=t[r]}):e},generateElement=function(e){var t=document.createElement(e.type);return Object.keys(e).map(function(r){"type"!==r&&"styles"!==r&&t.setAttribute(r,e[r])}),e.styles&&addElementStyles(t,e.styles),t},recurseHtml=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=function(e){return nextIndex(t,e)};if(0===n){var l=function(){var l=[];Array.isArray(t[n])&&(l=t[n].map(generateElement)),r.forEach(function(r){return l[l.length-1].appendChild(e(t,r,a(n),i++))});var o=!1;return l.forEach(function(e){o&&o.appendChild(e),o=e}),{v:l[0]}}();if("object"===("undefined"==typeof l?"undefined":_typeof(l)))return l.v}if(1===n&&t.length>2&&(t[n].styles.zIndex=i),Array.isArray(r)){var o=function(){var l=generateElement(t[n]);return r.forEach(function(r){return l.appendChild(e(t,r,a(n),i))}),{v:l}}();if("object"===("undefined"==typeof o?"undefined":_typeof(o)))return o.v}var u=generateElement(t[n]);return r instanceof Object&&(r=configureHtml(mergeObjects(r,{element:u}))),u},processHtml=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body;return r.appendChild(recurseHtml(e,t))},generateHtml=curry(processHtml),createTable=generateHtml(boardHTML()),update3dCell=function(e,t,r,n,i){return configureHtml(mergeObjects(t[i][n][r],e))},alter3dCell=curry(update3dCell),setViewShip=alter3dCell(mergeObjects(shipTile(),{styles:{backgroundColor:"#777"}})),setHiddenShip=alter3dCell(shipTile()),setShip=function(e,t,r){return r?setViewShip(e,t.x,t.y,t.z):setHiddenShip(e,t.x,t.y,t.z)},setHit=alter3dCell(hitTile()),updatePlayer=function(e,t,r){e.attacker&&(t?++e.attacks.hit:++e.attacks.miss,r&&++e.attacks.sunk),t||(e.attacker=!e.attacker)},endGame=function(e){return[e]},nextAttacker=function(e,t,r,n,i,a){return n&&e.status>0?(updatePlayer(e,i,a),!n):e.attacker?(updatePlayer(e,i,a),r>=t.length-1?(updatePlayer(t[0],i,a),n):!n):n},updateScore=function(e,t,r,n,i){e.status<=0&&i.push(e),n=n.filter(function(e){return e.status>0});var a=!1;return n.length<2?endGame(n[0]):n.map(function(e,i){return a=nextAttacker(e,n,i,a,t,r),e})},attackFleet=function(e,t,r,n,i){if(r.status<=0||r.attacker)return n;var a=setHit(e,t.x,t.y,t.z),l={};if(a.hasShip){var o=0;r.shipFleet.map(function(e){if(e.hasOwnProperty("parts")){var r=e.parts.filter(function(r){return r.point===t&&(l=e),!r.isHit});e.status=r.length/e.parts.length*100}return o+=e.status,e}),r.status=o/r.shipFleet.length}var u=l.status<=0?l.parts.length:0;return updateScore(r,a.hasShip,u,n,i)},launchAttack=curry(attackFleet);!function(){var e=[],t=function(t){for(var r=[],n=!0,i=0;i<t;++i){var a=playerSet();a.attacker=n,n=!1,a.board=rect3d(waterTile(),10,10,1),createTable(locateCells(a.board),document.body),a.shipFleet=defaultFleet(a.board,!0),bindListeners(a.board,launchAttack,a.board,a,r,e),r.push(a)}return r},r=t(2);console.log(r),console.log(e)}();
"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},curry=function(t){return function e(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return r.length>=t.length?t.apply(void 0,r):function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.apply(void 0,[].concat(r,n))}}},cloneObject=function(t){return JSON.parse(JSON.stringify(t))},mergeObjects=function t(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var i=n[0],o=n[1];n.length>2;){var a=n.splice(n.length-2,2);o=n[n.length-2]=t.apply(void 0,_toConsumableArray(a))}return"object"!==("undefined"==typeof i?"undefined":_typeof(i))||"object"!==("undefined"==typeof o?"undefined":_typeof(o))?"object"===("undefined"==typeof o?"undefined":_typeof(o))?o:i:(Object.keys(o).map(function(e){"object"===_typeof(o[e])&&i.hasOwnProperty(e)&&"object"===_typeof(i[e])&&(i[e]=t(i[e],o[e]),Object.keys(i[e]).length>Object.keys(o[e]).length&&(o[e]=cloneObject(i[e])))}),Object.assign(i,o))},fillArray=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return r=r.slice(),r.push(e),--n>0?t(cloneObject(e),n,r):r},buildArray=curry(fillArray),nextIndex=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e<t.length-1?++e:t.length-1},nextCell=function(t,e){return point(t.x+e.x,t.y+e.y,t.z+e.z)},pointDifference=function(t,e){return point(e.x-t.x,e.y-t.y,e.z-t.z)},bindPointData=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"z";return Object.keys(n).length||(n=point(0,0,0)),Array.isArray(e)?e.map(function(e,i){return n=mergeObjects(n,_defineProperty({},r,i)),t(e,n,r)}):"object"!==("undefined"==typeof e?"undefined":_typeof(e))||e.point?(e.point=cloneObject(n),e):(Object.keys(e).map(function(r){return Array.isArray(e[r])?t(e[r],n,r):e[r]}),e)},addElementStyles=function(t,e){return Object.keys(e).length&&t.style?Object.keys(e).forEach(function(n){return t.style[n]=e[n]}):t},generateElement=function(t){var e=document.createElement(t.type);return Object.keys(t).map(function(n){"type"!==n&&"styles"!==n&&e.setAttribute(n,t[n])}),t.styles&&addElementStyles(e,t.styles),e},bindElements=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Array.isArray(n)?n.map(function(n,r){return"z"===n.axis?t(e,n,r):t(e,n,0)}):(n.element&&e[n.axis]&&(e[n.axis].styles=mergeObjects(n.styles,Array.isArray(e[n.axis])?e[n.axis][e[n.axis].length-1].styles:e[n.axis].styles),Array.isArray(e[n.axis])?e[n.axis][0].styles.zIndex=r:e[n.axis].styles.zIndex=r,n.element=Array.isArray(e[n.axis])?e[n.axis].map(function(t){return n.element instanceof HTMLElement?n.element.appendChild(generateElement(t)):n.element=generateElement(t)})[0]:generateElement(e[n.axis])),Object.keys(n).map(function(r){return Array.isArray(n[r])?t(e,n[r],0):n[r]}),n)},buildHTML=function t(e){return Array.isArray(e)?e.map(function(e){return t(e)}):(Object.keys(e).map(function(n){return Array.isArray(e[n])?t(e[n]).map(function(t){return e.element instanceof HTMLElement?e.element.appendChild(t):t}):e[n]}),e.element)},appendHTML=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;return e.appendChild(buildHTML(t))},testPointsBetween=function(t,e,n,r){var i={true:[],false:[]},o=pointDifference(t,e);if(o.x>1)for(var a=t.x;a<e.x;++a){var l=point(a,t.y,t.z);r(l,n)?i.true.push(l):i.false.push(l)}else if(o.y>1)for(var u=t.y;u<e.y;++u){var s=point(t.x,u,t.z);r(s,n)?i.true.push(s):i.false.push(s)}else if(o.z>1)for(var c=t.z;c<e.z;++c){var f=point(t.x,t.y,c);r(f,n)?i.true.push(f):i.false.push(f)}return i},getInBetween=function(t,e,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o={true:[],false:[]};return i&&(r(t,n)?o.true.push(t):o.false.push(t),r(e,n)?o.true.push(e):o.false.push(e)),mergeObjects(o,testPointsBetween(t,e,n,r))},checkInBetween=function(t,e,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return!(!i||!r(t,n)&&!r(e,n))||!!testPointsBetween(t,e,n,r).true.length},getAxisLengths=function(t){return{x:t.z[0].y[0].x.length,y:t.z[0].y.length,z:t.z.length}},randCoords=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.floor(Math.random()*(t-(e-1)*n))},checkValidPoint=function(t,e){return!!(e.z[t.z]&&e.z[t.z].y[t.y]&&e.z[t.z].y[t.y].x[t.x]&&e.z[t.z].y[t.y].x[t.x].point)},getAllPoints=function(t){for(var e=getAxisLengths(t),n=[],r=0;r<e.z;++r)for(var i=0;i<e.y;++i)for(var o=0;o<e.x;++o)n.push(t.z[r].y[i].x[o].point);return n},adjacentPoints=function(t,e){for(var n=[],r=-1;r<2;++r)for(var i=-1;i<2;++i)for(var o=-1;o<2;++o){var a=point(t.x+o,t.y+i,t.z+r);checkValidPoint(a,e)&&point!==a&&n.push(a)}return n},adjacentEdgePoints=function(t,e){return[point(-1,0,0),point(1,0,0),point(0,-1,0),point(0,1,0),point(0,0,-1),point(0,0,1)].map(function(e){return point(t.x+e.x,t.y+e.y,t.z+e.z)}).filter(function(t){return checkValidPoint(t,e)})},bindListeners=function t(e,n,r){for(var i=arguments.length,o=Array(i>3?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];return Array.isArray(e)?e.map(function(e){return t.apply(void 0,[e,n,r].concat(o))}):"object"!==("undefined"==typeof e?"undefined":_typeof(e))||e.point?e.element instanceof HTMLElement&&e.point?e.element.addEventListener(n,function(){return r.apply(void 0,[e.point].concat(o))}):e.element:(Object.keys(e).map(function(i){return Array.isArray(e[i])?t.apply(void 0,[e[i],n,r].concat(o)):e[i]}),e)},checkIfShipCell=function(t,e){return e.z[t.z].y[t.y].x[t.x].hasShip},checkIfHitCell=function(t,e){return e.z[t.z].y[t.y].x[t.x].isHit},getAllNonHitCells=function(t){return getAllPoints(t).filter(function(e){return!checkIfHitCell(e,t)})},getAdjNonHitCells=function(t,e){return adjacentPoints(t,e).filter(function(t){return!checkIfHitCell(t,e)})},getAdjEdgeNonHitCells=function(t,e){return adjacentEdgePoints(t,e).filter(function(t){return!checkIfHitCell(t,e)})},getALowStatusItem=function(t){return t.reduce(function(t,e){return e.status<=t.status?e:t})},getLowStatusItems=function(t){return t.filter(function(e){return e.status<=getALowStatusItem(t).status})},getBrokenItems=function(t){return t.filter(function(t){return t.status<100&&t.status>0})},getBrokenShipsPlayers=function(t){return t.filter(function(t){return getBrokenItems(t.shipFleet).length})},numDamangedParts=function(t,e){return t-Math.ceil(e/100*t)},buildShip=function(t,e,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=ship(),a=e,l=0;l<t;++l)o.parts.push(setShip(r,a,i)),a=nextCell(a,n);return o},generateRandomFleet=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=getAxisLengths(e);for(var o in t){var a=point(1,0,0),l=point(0,0,0),u=point(0,0,0),s=t[o]<=i.z?1:0;do{switch(Math.floor(Math.random()*(2+s))){case 0:a=point(1,0,0);break;case 1:a=point(0,1,0);break;default:a=point(0,0,1)}l=point(randCoords(i.x,t[o],a.x),randCoords(i.y,t[o],a.y),randCoords(i.z,t[o],a.z)),u=point(l.x+a.x*(t[o]-1),l.y+a.y*(t[o]-1),l.z+a.z*(t[o]-1))}while(checkInBetween(l,u,e,checkIfShipCell));r.push(buildShip(t[o],l,a,e,n))}return r},randomFleet=curry(generateRandomFleet),point=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:t,y:e,z:n}},tile=function(){return{point:{},styles:{},element:{}}},coordinate=function(t){return{axis:t,element:{}}},matrix=function(t,e,n){for(var r=arguments.length,i=Array(r>4?r-4:0),o=4;o<r;o++)i[o-4]=arguments[o];var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return mergeObjects.apply(void 0,[coordinate("base"),{z:buildArray(mergeObjects.apply(void 0,[coordinate("z"),{y:buildArray(mergeObjects.apply(void 0,[coordinate("y"),{x:buildArray(mergeObjects.apply(void 0,[coordinate("x"),t].concat(i)),e)}].concat(i)),n)}].concat(i)),a)}].concat(i))},square=function(t,e){return matrix(t,e,e)},cube=function(t,e){return matrix(t,e,e,e)},tableHTML=function(){return{base:[{type:"table",class:"matrix"}],z:{type:"tbody"},y:{type:"tr",class:"row"},x:{type:"td",class:"column"}}},gameTile=function(){return{hasShip:!1,isHit:!1,styles:{}}},waterTile=function(){return mergeObjects(tile(),gameTile(),{styles:{}})},shipTile=function(){return{hasShip:!0}},ship=function(){return{status:100,parts:[]}},hitTile=function(){return{isHit:!0}},boardHTML=function(){return{base:[{type:"div",class:"matrix",styles:{}}],z:{type:"div",class:"layer",styles:{}},y:{type:"div",class:"row",styles:{}},x:{type:"div",class:"column",styles:{}}}},playerSet=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{name:t,isRobot:!1,status:100,turnCnt:0,attacker:!1,attacks:{hit:0,miss:0,sunk:0},board:{},shipFleet:[]}},defaultFleet=randomFleet([5,4,3,3,2]),selectTargetPlayer=function(t){var e=getBrokenShipsPlayers(t).length?getBrokenShipsPlayers(t):getLowStatusItems(t);return 1===e.length?e[0]:e[Math.floor(Math.random()*e.length)]},selectTargetCoord=function(t,e){var n=getBrokenItems(t.shipFleet);if(n.length){var r=function(){var r=n.filter(function(t){return numDamangedParts(t.parts.length,t.status)>1}),i=getALowStatusItem(r.length?r:n),o=i.parts.filter(function(e){return checkIfHitCell(e.point,t.board)});if(r.length){for(var a=0;a<o.length;++a){var l=getInBetween(o[0].point,o[a].point,t.board,checkIfHitCell,!1);if(l.false.length)return{v:l.false[0]}}var u=pointDifference(o[0].point,o[1].point),s=u.x>0?[point(-1,0,0),point(1,0,0)]:[point(0,-1,0),point(0,1,0)],c=s.map(function(t,e){return nextCell(o[(o.length-1)*e].point,t)}).filter(function(e){return checkValidPoint(e,t.board)}).reduce(function(e,n){return checkIfHitCell(e,t.board)?n:e});if(c)return{v:c}}e=o[0].point}();if("object"===("undefined"==typeof r?"undefined":_typeof(r)))return r.v}var i=e?getAdjEdgeNonHitCells(e,t.board):getAllNonHitCells(t.board);return i.length?i[Math.floor(Math.random()*i.length)]:getAllNonHitCells(t.board)[Math.floor(Math.random()*i.length)]},computerAttack=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=selectTargetPlayer(e.filter(function(t){return!t.attacker}));attackFleet(selectTargetCoord(i,r),i.board,i,e,n)},configureHtml=function(t){return t.isHit&&(t.styles.backgroundColor=t.hasShip?"red":"white"),addElementStyles(t.element,t.styles),t},update3dCell=function(t,e,n,r,i){return configureHtml(mergeObjects(e.z[i].y[r].x[n],t))},alter3dCell=curry(update3dCell),setViewShip=alter3dCell(mergeObjects(shipTile(),{styles:{backgroundColor:"#777"}})),setHiddenShip=alter3dCell(shipTile()),setShip=function(t,e,n){return n?setViewShip(t,e.x,e.y,e.z):setHiddenShip(t,e.x,e.y,e.z)},setHit=alter3dCell(hitTile()),updatePlayer=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t.attacker&&(e?++t.attacks.hit:++t.attacks.miss,n&&++t.attacks.sunk),e||(t.attacker=!t.attacker,t.attacker?(t.board.element.style.fontSize="0.5rem",++t.turnCnt):t.board.element.style.fontSize="1rem"),t},endGame=function(t){return[t]},getNextAttacker=function(t,e,n){var r=e.indexOf(t),i={};do i=e.length>1&&r>=e.length-1?e[0]:e[++r];while(i.status<=0);return n?t:updatePlayer(i,n)},updateScore=function(t,e,n,r,i,o){t.status<=0&&i.push(t),r=r.filter(function(t){return t.status>0});var a=r.reduce(function(t,e){return t.attacker?t:e});if(a=updatePlayer(a,e,n),r.length<2)return endGame(r[0]);var l=getNextAttacker(a,r,e);return l.isRobot&&computerAttack(l,r,i,!!e&&o),r},attackFleet=function(t,e,n,r,i){if(n.status<=0||n.attacker)return r;var o=setHit(e,t.x,t.y,t.z),a={};if(o.hasShip){var l=0;n.shipFleet.map(function(e){if(e.hasOwnProperty("parts")){var n=e.parts.filter(function(n){return n.point===t&&(a=e),!n.isHit});e.status=n.length/e.parts.length*100}return l+=e.status,e}),n.status=l/n.shipFleet.length}var u=a.status<=0?a.parts.length:0;return updateScore(n,o.hasShip,u,r,i,t)},launchAttack=curry(attackFleet);!function(){var t=[],e=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=[],i=e+n;i<2&&(i=2);for(var o=0;o<i;++o){var a=playerSet();a.isRobot=--e<0;var l=square(waterTile(),10);l=bindPointData(l),l=bindElements(boardHTML(),l),a.board=l;appendHTML(a.board);a.shipFleet=defaultFleet(a.board,!1),bindListeners(a.board,"click",launchAttack,a.board,a,r,t),r.push(a)}return r},n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=updatePlayer(n?t[0]:t[Math.floor(Math.random()*t.length)]);r.isRobot&&computerAttack(r,t,e,!1)},r=e(1);console.log(r),console.log(t),n(r,t,!1)}();
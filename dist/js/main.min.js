"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},curry=function(t){return function e(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return r.length>=t.length?t.apply(void 0,r):function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.apply(void 0,[].concat(r,n))}}},mapObject=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Array.isArray(t)?t.map(function(t,n){return 1===e.length?e(t):e(t,n)}):Object.keys(t).reduce(function(n,r){return n[r]=1===e.length?e(t[r]):e(t[r],r),n},n)},filterObject=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Array.isArray(t)?t.filter(function(t,n){return 1===e.length?e(t):e(t,n)}):Object.keys(t).reduce(function(n,r){return(1===e.length?e(t[r]):e(t[r],r))?n[r]=t[r]:delete n[r],n},n)},notEmptyObjectOrArray=function(t){return!!("object"===(void 0===t?"undefined":_typeof(t))&&Object.keys(t).length||Array.isArray(t)&&t.length)},cloneObject=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return cloneExclusions(JSON.parse(JSON.stringify(t,function(t,n){return removeCircularReference(t,n,e)})),t,e=[])},inArray=function(t,e){return t.indexOf(e)>=0},removeCircularReference=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("object"===(void 0===e?"undefined":_typeof(e))){if(inArray(n,e))return;n.push(e)}return e},recursiveMap=function(t,e,n){for(var r=arguments.length,i=Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];return function(r,a){return e(r,a)?r:n.apply(void 0,[t[a],r].concat(i))}},cloneRules=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n,r){return!t[r]||n instanceof HTMLElement||"parentItem"===r||"listenerArgs"===r||!!e&&e(n,r)}},cloneExMap=function(t,e,n,r){return mapObject(e,recursiveMap(t,cloneRules(t,curry(inArray)(n.concat([e]))),r,n.concat([e])))},cloneExclusions=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return notEmptyObjectOrArray(n)?cloneExMap(e,n,r,t):e},mergeObjects=function t(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return 2===n.length?notEmptyObjectOrArray(n[1])?mapObject(n[1],recursiveMap(n[0],cloneRules(n[0]),t),cloneObject(n[0])):n[1]:1===n.length?n[0]:n.reduce(function(e,n){return t(e,n)},{})},mergeObjectsMutable=function t(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return 2===n.length?notEmptyObjectOrArray(n[1])?mapObject(n[1],recursiveMap(n[0],cloneRules(n[0]),t),n[0]):n[1]:1===n.length?n[0]:n.reduce(function(e,n){return t(e,n)},{})},buildArray=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return--n>0?t(r?e:cloneObject(e),n,r,i.concat([e])):i.concat([e])},queueTimeout=function t(){for(var e=arguments.length,n=Array(e>2?e-2:0),r=2;r<e;r++)n[r-2]=arguments[r];var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.queue=t.queue||[],t.isRunning=t.isRunning||!1;var u={id:0,func:i,timeout:a,args:n,result:0};if(i&&t.queue.push(u),t.queue.length&&!t.isRunning){t.isRunning=!0;var o=t.queue.shift();return o.id=setTimeout(function(){return o.result=o.func.apply(o,_toConsumableArray(o.args)),t.isRunning=!1,t(!1)},o.timeout),o}return u},DOMItem=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return mergeObjectsMutable.apply(void 0,[{tagName:"div",attributes:{styles:{}},element:{},eventListeners:{},parentItem:{},children:[]}].concat(e))},initChildren=function(){return[DOMItem({tagName:"head",attributes:{},element:document.head,children:[]}),DOMItem({tagName:"body",attributes:{},element:document.body,children:[]})]},initRoot=function(t){return DOMItem({tagName:"html",attributes:{},element:document,children:t,head:t[0],body:t[1]})},documentDOMItem=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initRoot(initChildren());return DOMItem(t,{children:t.children.map(function(e){return DOMItem(e,{parentItem:t})})})},documentItem=documentDOMItem(),elementHasAttribute=function(t,e,n){return t instanceof HTMLElement&&(e in t?t[e]===n:"styles"===e?Object.keys(n).filter(function(e){return!inArray(Object.keys(t.style),e)||n[e]!==t.style[e]}).concat(Object.keys(t.style)).reduce(function(e,r){return e[r]=inArray(Object.keys(n),r)?inArray(Object.keys(t.style),r)?0:1:-1,e},{}):"class"===e?n.split(" ").filter(function(e){return!inArray(t.className.split(" "),e)}).concat(t.className.split(" ")).filter(function(t){return!!t.length}).reduce(function(e,r){return e[r]=inArray(n.split(" "),r)?inArray(t.className.split(" "),r)?1:0:-1,e},{}):t.hasAttribute(e)&&t.getAttribute(e)===n)},elementChanges=function(t){return t.element.tagName.toLowerCase()===t.tagName.toLowerCase()?mergeObjects(t,{attributes:filterObject(t.attributes,function(e,n){return filterObject(mapObject(t.attributes,function(e,n){return"object"===(void 0===e?"undefined":_typeof(e))||"class"===n?filterObject(elementHasAttribute(t.element,n,e),function(t){return 1!==t||!1===t}):!elementHasAttribute(t.element,n,e)}),function(t){return!("object"===(void 0===t?"undefined":_typeof(t))&&!Object.keys(t).length)&&t})[n]})}):generateElement(t)},updateElement=function(t){return console.log(t),console.log(t.attributes),t.element instanceof HTMLElement?mergeObjects(t,{attributes:mapObject(t.attributes,function(e,n){return n in t.element?(t.element[n]=e,e):"styles"===n?(mapObject(e,function(e,n){return t.element.style[n]=e},t.element.style),e):"class"===n?(t.element.className=e,e):(t.element.setAttribute(n,e),e)})}):t},updateElements=function t(e){(e=updateElement(e)).children.map(function(e){return t(e)})},generateElement=function(t){return t.element=document.createElement(t.tagName),updateElement(t).element},bindElements=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:documentItem;return DOMItem(e,{tagName:e.tagName||"div",attributes:e.attributes||{styles:{}},element:e.element&&e.element instanceof HTMLElement?e.element:generateElement(e),eventListeners:e.eventListeners||{},parentItem:n,children:e.children?e.children.map(function(n){return t(n,e)}):[]})},buildHTML=function t(e){return e.children.map(function(n){return e.element.appendChild(t(n))}),e.element},appendHTML=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:documentItem.body;return Array.isArray(t)?t.map(function(t){return e.children.push(t)}):e.children.push(t),buildHTML(e),t},removeChild=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:documentItem.body;return e.element.removeChild(t.element),e.children.splice(e.children.indexOf(t),1)},listenerOptions=function t(e){if(void 0===t.supportsOptions){t.supportsOptions=!0;try{window.addEventListener("test",null,{capture:!1,once:!1,passive:!1})}catch(e){t.supportsOptions=!1}}return!("object"!==(void 0===e?"undefined":_typeof(e))||!t.supportsOptions)&&e},assignListener=function(t,e,n,r){return e.addEventListener?e.addEventListener(t,n,listenerOptions(r)):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},bindListeners=function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return mergeObjects(e,{element:e.eventListeners&&Object.keys(e.eventListeners).length&&e.element instanceof HTMLElement?mapObject(e.eventListeners,function(t,r){return assignListener(r,e.element,function(n){return t.listenerFunc(n,e,t.listenerArgs)},n)},e.element):e.element,children:e.children.map(function(e){return t(e,n)})})},getChildrenFromAttribute=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:documentItem.body;return r.attributes[e]&&r.attributes[e]===n?r.children.reduce(function(r,i){return r.concat(t(e,n,i))},[]).concat([r]):r.children.reduce(function(r,i){return r.concat(t(e,n,i))},[])},getChildrenByClass=curry(getChildrenFromAttribute)("class"),getChildrenByName=curry(getChildrenFromAttribute)("name"),getTopParentItem=function t(e){return Object.keys(e.parentItem).length?t(e.parentItem):e},renderHTML=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:documentItem,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return bindListeners(appendHTML(mergeObjectsMutable(bindElements(t(),e),t(e)),e.body),n)},point=function(t,e){return{x:t,y:e,z:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0}},tile=function(){return{point:{}}},coordinate=function(t){return{axis:t}},matrix=function(t,e,n){for(var r=arguments.length,i=Array(r>4?r-4:0),a=4;a<r;a++)i[a-4]=arguments[a];var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return DOMItem({tagName:"div",attributes:{class:"matrix"},children:buildArray(DOMItem.apply(void 0,[coordinate("z"),{tagName:"div",attributes:{class:"layer"},children:buildArray(DOMItem.apply(void 0,[coordinate("y"),{tagName:"div",attributes:{class:"row"},children:buildArray(DOMItem.apply(void 0,[coordinate("x"),{tagName:"div",attributes:{class:"column"}}].concat(i,[t])),e)}].concat(i)),n)}].concat(i)),u)})},square=function(t,e){return matrix(t,e,e)},cube=function(t,e){return matrix(t,e,e,e)},bindPointData=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:point(0,0,0);return mergeObjects(e,e.point?{point:cloneObject(n)}:{children:e.children.map(function(e,r){return t(e,mergeObjects(n,_defineProperty({},e.axis,r)))})})},nextCell=function(t,e){return point(t.x+e.x,t.y+e.y,t.z+e.z)},pointDifference=function(t,e){return point(e.x-t.x,e.y-t.y,e.z-t.z)},checkEqualPoints=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},testPointsBetween=function(t,e,n,r){var i={true:[],false:[]},a=pointDifference(t,e);if(a.x>1)for(var u=t.x;u<e.x;++u){var o=point(u,t.y,t.z);r(o,n)?i.true.push(o):i.false.push(o)}else if(a.y>1)for(var l=t.y;l<e.y;++l){var s=point(t.x,l,t.z);r(s,n)?i.true.push(s):i.false.push(s)}else if(a.z>1)for(var c=t.z;c<e.z;++c){var d=point(t.x,t.y,c);r(d,n)?i.true.push(d):i.false.push(d)}return i},getInBetween=function(t,e,n,r){var i={true:[],false:[]};return(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&(r(t,n)?i.true.push(t):i.false.push(t),r(e,n)?i.true.push(e):i.false.push(e)),mergeObjects(i,testPointsBetween(t,e,n,r))},checkInBetween=function(t,e,n,r){return!(!(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])||!r(t,n)&&!r(e,n))||!!testPointsBetween(t,e,n,r).true.length},getAxisLengths=function(t){return point(t.children[0].children[0].children.length,t.children[0].children.length,t.children.length)},randCoords=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.floor(Math.random()*(t-(e-1)*n))},randDirection=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.length?t[Math.floor(Math.random()*t.length)]:point(0,0,0)},checkValidPoint=function(t,e){return!!(e.children[t.z]&&e.children[t.z].children[t.y]&&e.children[t.z].children[t.y].children[t.x]&&e.children[t.z].children[t.y].children[t.x].point)},getDOMItemFromPoint=function(t,e){return!!checkValidPoint(t,e)&&e.children[t.z].children[t.y].children[t.x]},getAllPoints=function(t){for(var e=getAxisLengths(t),n=[],r=0;r<e.z;++r)for(var i=0;i<e.y;++i)for(var a=0;a<e.x;++a)n.push(t.children[r].children[i].children[a].point);return n},adjacentPoints=function(t,e){for(var n=[],r=-1;r<2;++r)for(var i=-1;i<2;++i)for(var a=-1;a<2;++a){var u=point(t.x+a,t.y+i,t.z+r);checkValidPoint(u,e)&&point!==u&&n.push(u)}return n},adjacentEdgePoints=function(t,e){return[point(-1,0,0),point(1,0,0),point(0,-1,0),point(0,1,0),point(0,0,-1),point(0,0,1)].map(function(e){return point(t.x+e.x,t.y+e.y,t.z+e.z)}).filter(function(t){return checkValidPoint(t,e)})},mainMenu=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{tagName:"div",attributes:{class:"main-menu"},children:[{tagName:"div",attributes:{class:"content"},children:[{tagName:"form",attributes:{class:"main-menu-form"},eventListeners:{submit:{listenerFunc:beginRound,listenerArgs:{parent:t}}},children:[{tagName:"div",attributes:{class:"form-group"},children:[{tagName:"label",attributes:{for:"human-players",innerText:"Humans"}},{tagName:"input",attributes:{id:"human-players",name:"human-players",type:"number",value:0,min:0,max:100,required:""}}]},{tagName:"div",attributes:{class:"form-group"},children:[{tagName:"label",attributes:{for:"robot-players",innerText:"Robots"}},{tagName:"input",attributes:{id:"robot-players",name:"robot-players",type:"number",value:0,min:0,max:100,required:""}}]},{tagName:"label",attributes:{for:"first-go-first",innerText:"First Player Starts"}},{tagName:"input",attributes:{id:"first-go-first",name:"first-go-first",type:"checkbox"}},{tagName:"input",attributes:{type:"submit",value:"Start"}}]}]}]}},boards=function(){return{tagName:"div",attributes:{class:"boards"}}},finalScore=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{tagName:"div",attributes:{class:"final-scores"},children:[{tagName:"div",attributes:{class:"score-cards"},children:t.map(function(t){return{tagName:"div",attributes:{class:"score-card",innerHTML:"<strong>"+t.name+"</strong><hr><br></strong><strong>Status:</strong> "+Math.round(100*t.status)/100+"%, <strong>Sunk:</strong> "+t.attacks.sunk+"<br><strong>Hit:</strong> "+t.attacks.hit+" / <strong>Miss:</strong> "+t.attacks.miss+"<br><strong>Turns:</strong> "+t.turnCnt}}})},{tagName:"input",attributes:{type:"button",value:"Restart"},eventListeners:{click:{listenerFunc:restart,listenerArgs:{parent:e}}}}]}},checkIfShipCell=function(t,e){return e.children[t.z].children[t.y].children[t.x].hasShip},checkIfHitCell=function(t,e){return e.children[t.z].children[t.y].children[t.x].isHit},getAllNonHitCells=function(t){return getAllPoints(t).filter(function(e){return!checkIfHitCell(e,t)})},getAdjNonHitCells=function(t,e){return adjacentPoints(t,e).filter(function(t){return!checkIfHitCell(t,e)})},getAdjEdgeNonHitCells=function(t,e){return adjacentEdgePoints(t,e).filter(function(t){return!checkIfHitCell(t,e)})},getALowStatusItem=function(t){return t.reduce(function(t,e){return e.status<=t.status?e:t})},getLowStatusItems=function(t){return t.filter(function(e){return e.status<=getALowStatusItem(t).status})},getBrokenItems=function(t){return t.filter(function(t){return t.status<100&&t.status>0})},getBrokenShipsPlayers=function(t){return t.filter(function(t){return getBrokenItems(t.shipFleet).length})},numDamangedParts=function(t,e){return t-Math.ceil(e/100*t)},filterAdjacentPoints=function(t){return t.z%2==0&&(t.x%2==0&&t.y%2==0||t.x%2!=0&&t.y%2!=0)||t.z%2!=0&&(t.x%2!=0&&t.y%2==0||t.x%2==0&&t.y%2!=0)},buildShip=function(t,e,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=ship(t.name),u=e,o=0;o<t.size;++o)a.parts.push(setShip(r,u,i)),u=nextCell(u,n);return a},generateStartDir=function t(e,n,r,i){var a=randDirection(i),u=point(randCoords(r.x,n,a.x),randCoords(r.y,n,a.y),randCoords(r.z,n,a.z)),o=point(u.x+a.x*(n-1),u.y+a.y*(n-1),u.z+a.z*(n-1));return checkInBetween(u,o,e,checkIfShipCell)?t(e,n,r,i):{start:u,dir:a}},generateRandomFleet=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=getAxisLengths(e);for(var a in t){point(0,0,0),point(0,0,0);var u=[];if(t[a].size<=i.x&&u.push(point(1,0,0)),t[a].size<=i.y&&u.push(point(0,1,0)),t[a].size<=i.z&&u.push(point(0,0,1)),u.length){var o=generateStartDir(e,t[a].size,i,u);r.push(buildShip(t[a],o.start,o.dir,e,n))}}return r},buildPlayers=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:documentItem,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(e<1&&n<1)return i;var a=bindElements(bindPointData(square(waterTile(),10)),r),u=bindElements(playerSet(a,"Player "+(i.length+1)),r);u.isRobot=e<=0,u.shipFleet=defaultFleet(u.board,!0);var o=bindElements(playerStats(u,Math.round(100*u.status)/100+"%"),u);return u.playerStats=o,u.children.push(o),console.log(u),i.push(u),t(--e,e<0?--n:n,r,i)},beginRound=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{parent:documentItem};t.preventDefault();var r=parseInt(getChildrenByName("human-players",e)[0].element.value),i=parseInt(getChildrenByName("robot-players",e)[0].element.value);if(r<0||r>100||i<0||i>100)return!1;var a=getChildrenByName("first-go-first",e)[0].element.checked;0===(r=r<0?0:r)&&(i=i<2?2:i),1===r&&(i=i<1?1:i),removeChild(getChildrenByClass("main-menu",n.parent.body)[0],n.parent.body);var u=appendHTML(bindElements(boards(),n.parent.body),n.parent.body),o=buildPlayers(r,i,u);appendHTML(o,u),console.log(o);var l=updatePlayer(a?o[0]:o[Math.floor(Math.random()*o.length)]);return l.isRobot&&computerAttack(l,o,!1),!1},main=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:documentItem,e=t.body.children.length-1;e>=0;--e)removeChild(t.body.children[e],t.body);return renderHTML(mainMenu,t),t},restart=function(t,e,n){return main(n.parent)},gameTile=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{hasShip:!1,isHit:!1,eventListeners:{click:{listenerFunc:attackListener,listenerArgs:{player:t,players:e}}}}},waterTile=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return mergeObjects(gameTile(t,e),tile())},shipTile=function(){return{hasShip:!0}},ship=function(){return{name:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",status:100,parts:[]}},hitTile=function(){return{isHit:!0}},playerSet=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{name:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",isRobot:!1,status:100,turnCnt:0,attacker:!1,attacks:{hit:0,miss:0,sunk:0},board:t,shipFleet:[],playerStats:{},tagName:"div",attributes:{class:"player"},children:[t]}},playerStats=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{tagName:"div",attributes:{},children:[{tagName:"span",attributes:{innerHTML:"<strong>"+t.name+"</strong>: "+e}},{tagName:"ul",attributes:{},children:t.shipFleet.map(function(t){return{tagName:"li",attributes:{innerHTML:"<strong>"+t.name+" ("+t.parts.length+"):</strong> "+Math.round(100*t.status)/100+"%"}}})}]}},defaultFleet=curry(generateRandomFleet)([{name:"Aircraft Carrier",size:5},{name:"Battleship",size:4},{name:"Submarine",size:3},{name:"Cruiser",size:3},{name:"Destroyer",size:2}]),selectTargetPlayer=function(t){var e=getBrokenShipsPlayers(t).length?getBrokenShipsPlayers(t):getLowStatusItems(t);return 1===e.length?e[0]:e[Math.floor(Math.random()*e.length)]},selectTargetCoord=function(t){var e=getBrokenItems(t.shipFleet),n=[];if(e.length){var r=e.filter(function(t){return numDamangedParts(t.parts.length,t.status)>1}),i=getALowStatusItem(r.length?r:e).parts.filter(function(e){return checkIfHitCell(e.point,t.board)});if(r.length){for(var a=0;a<i.length;++a){var u=getInBetween(i[0].point,i[a].point,t.board,checkIfHitCell,!1);if(u.false.length)return displayTargets(u.false,u.false[0],t),u.false[0]}var o=(pointDifference(i[0].point,i[1].point).x>0?[point(-1,0,0),point(1,0,0)]:[point(0,-1,0),point(0,1,0)]).map(function(t,e){return nextCell(i[(i.length-1)*e].point,t)}).filter(function(e){return checkValidPoint(e,t.board)}).filter(function(e){return!checkIfHitCell(e,t.board)}),l=o.reduce(function(e,n){return checkIfHitCell(e,t.board)?n:e});if(l)return displayTargets(o,l,t),l}n=getAdjEdgeNonHitCells(i[0].point,t.board)}var s=n.length?n:getAllNonHitCells(t.board).filter(function(t){return filterAdjacentPoints(t)}),c=s[Math.floor(Math.random()*s.length)];return displayTargets(s,c,t),c},displayTargets=function(t,e,n){return[queueTimeout(resetTargets,0,{targets:t,victim:n}),queueTimeout(resetTargets,400,{targets:t,target:e,victim:n})]},resetTargets=function(t){if(t.victim.board.children.map(function(t){return updateElement(mergeObjects(t,{attributes:{styles:{borderColor:"#333"}}}))}),t.targets.forEach(function(e){return updateElement(mergeObjects(getDOMItemFromPoint(e,t.victim.board),{attributes:{styles:{borderColor:"#333"}}}))}),t.target)return setHit(t.victim.board,t.target.x,t.target.y,t.target.z,t.victim.isRobot);t.victim.board.children.map(function(t){return updateElement(mergeObjects(t,{attributes:{styles:{borderColor:"yellow"}}}))}),t.targets.forEach(function(e){return updateElement(mergeObjects(getDOMItemFromPoint(e,t.victim.board),{attributes:{styles:{borderColor:"yellow"}}}))})},computerAttack=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=selectTargetPlayer(e.filter(function(t){return!t.attacker}));attackFleet.isLocked=!1,attackFleet(selectTargetCoord(r,n),r,e)},configureHtml=function(t,e){return t.isHit&&(t.attributes.styles.backgroundColor=t.hasShip?"red":"white"),e?(attackFleet.isLocked=!0,queueTimeout(function(){return t=updateElement(t),attackFleet.isLocked=!1,t},0)):t=updateElement(t),t},update3dCell=function(t,e,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return configureHtml(mergeObjectsMutable(e.children[i].children[r].children[n],t),a)},setViewShip=curry(update3dCell)(mergeObjects(shipTile(),{attributes:{styles:{backgroundColor:"#777"}}})),setHiddenShip=curry(update3dCell)(shipTile()),setHit=curry(update3dCell)(hitTile()),setShip=function(t,e,n){return n?setViewShip(t,e.x,e.y,e.z):setHiddenShip(t,e.x,e.y,e.z)},updatePlayerStats=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.round(100*t.status)/100+"%";return t.playerStats=mergeObjects(t.playerStats,playerStats(t,e)),updateElements(t.playerStats),t},updatePlayer=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.attacker&&(e?++t.attacks.hit:++t.attacks.miss,n&&++t.attacks.sunk);return e||(t.attacker=!t.attacker,attackFleet.isLocked=!0,t.attacker?(queueTimeout(function(){return attackFleet.isLocked=!1,t.board.children.map(function(t){return t.children.map(function(t){return t.children.map(function(t){return updateElement(mergeObjects(t,{attributes:{styles:{width:"17px",height:"17px"}}}))})})})},400),++t.turnCnt):queueTimeout(function(){return attackFleet.isLocked=!1,t.board.children.map(function(t){return t.children.map(function(t){return t.children.map(function(t){return updateElement(mergeObjects(t,{attributes:{styles:{width:"35px",height:"35px"}}}))})})})},0)),queueTimeout(function(){return updatePlayerStats(t,t.attacker?"ATTACKER":Math.round(100*t.status)/100+"%")},0).result||t},endGame=function(t){var e=getTopParentItem(t);return t.parentItem.children.map(function(t){return updatePlayerStats(t)}),t=updatePlayerStats(t,"WINNER"),renderHTML(finalScore,e),[t]},findNextAttacker=function t(e,n,r){var i=n.length>1&&r>=n.length-1?n[0]:n[++r];return i.status>0?i:t(e,n,r)},getNextAttacker=function(t,e,n){return n?t:updatePlayer(findNextAttacker(t,e,e.indexOf(t)),n)},updateScore=function(t,e,n,r,i){var a=(r=r.filter(function(t){return t.status>0})).reduce(function(t,e){return t.attacker?t:e});if(a=updatePlayer(a,e,n),r.length<2)return queueTimeout(function(){return endGame(r[0])},400);var u=getNextAttacker(a,r,e);return u.isRobot&&queueTimeout(computerAttack,0,u,r,!!e&&i),r},attackFleet=function t(e,n,r){if(t.isLocked=t.isLocked||!1,n.status<=0||n.attacker||t.isLocked)return r;var i=setHit(n.board,e.x,e.y,e.z,r.reduce(function(t,e){return t.attacker?t:e}).isRobot),a=!1,u=0;if(i.hasShip){var o=0;n.shipFleet.map(function(t){var n=t.parts.filter(function(n){return checkEqualPoints(n.point,e)&&(a=t),!n.isHit});return t.status=n.length/t.parts.length*100,o+=t.status,t}),n.status=o/n.shipFleet.length}return a&&(n=updatePlayerStats(n,Math.round(100*n.status)/100+"%"),u=a.status<=0?a.parts.length:0),updateScore(n,i.hasShip,u,r,e)},attackListener=function(t,e,n){return attackFleet.apply(void 0,[e.point].concat([n.player,n.players]))};!function(){var t=main(documentDOMItem());console.log(t)}();
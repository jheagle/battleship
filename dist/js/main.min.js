"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},curry=function(e){return function t(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return r.length>=e.length?e.apply(void 0,r):function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.apply(void 0,[].concat(r,n))}}},cloneObject=function(e){return JSON.parse(JSON.stringify(e))},mergeObjects=function e(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=n[0],i=n[1];n.length>2;){var o=n.splice(n.length-2,2);i=n[n.length-2]=e.apply(void 0,_toConsumableArray(o))}return"object"!==("undefined"==typeof a?"undefined":_typeof(a))||"object"!==("undefined"==typeof i?"undefined":_typeof(i))?"object"===("undefined"==typeof i?"undefined":_typeof(i))?i:a:(Object.keys(i).map(function(t){"object"===_typeof(i[t])&&a.hasOwnProperty(t)&&"object"===_typeof(a[t])&&(a[t]=e(a[t],i[t]),Object.keys(a[t]).length>Object.keys(i[t]).length&&(i[t]=cloneObject(a[t])))}),Object.assign(a,i))},fillArray=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return r=r.slice(),r.push(t),--n>0?e(cloneObject(t),n,r):r},buildArray=curry(fillArray),nextIndex=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t<e.length-1?++t:e.length-1},nextCell=function(e,t){return{x:e.x+t.x,y:e.y+t.y,z:e.z+t.z}},bindPointData=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object.keys(n).length||(n=point(0,0,0)),Array.isArray(t)?t.map(function(t,a){switch(r){case 0:n=mergeObjects(n,{z:a});break;case 1:n=mergeObjects(n,{y:a});break;default:n=mergeObjects(n,{x:a})}return e(t,n,r+1)}):(t.point=cloneObject(n),t)},checkInBetween=function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(a&&(r(e,n)||r(t,n)))return!0;var i=t.x-e.x,o=t.y-e.y,l=t.z-e.z;if(i>0){for(var u=e.x;u<t.x;++u)if(r({x:u,y:e.y,z:e.z},n))return!0}else if(o>0){for(var c=e.y;c<t.y;++c)if(r({x:e.x,y:c,z:e.z},n))return!0}else if(l>0)for(var s=e.z;s<t.z;++s)if(r({x:e.x,y:e.y,z:s},n))return!0;return!1},randCoords=function(e,t,n){return Math.floor(Math.random()*(e-(t-1)*n))},bindListeners=function e(t,n,r){for(var a=arguments.length,i=Array(a>3?a-3:0),o=3;o<a;o++)i[o-3]=arguments[o];return Array.isArray(t)?t.map(function(t){return e.apply(void 0,[t,n,r].concat(i))}):t.element instanceof HTMLElement?t.element.addEventListener(n,function(){return r.apply(void 0,[t.point].concat(i))}):t.element},checkIfShipCell=function(e,t){return t[e.z][e.y][e.x].hasShip},buildShip=function(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=ship(),o=t,l=0;l<e;++l)i.parts.push(setShip(r,o,a)),o=nextCell(o,n);return i},generateRandomFleet=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],a={x:t[0][0].length,y:t[0].length,z:t.length};for(var i in e){var o=point(1,0,0),l=point(0,0,0),u=point(0,0,0),c=e[i]<=a.z?1:0;do{switch(Math.floor(Math.random()*(2+c))){case 0:o=point(1,0,0);break;case 1:o=point(0,1,0);break;default:o=point(0,0,1)}l=point(randCoords(a.x,e[i],o.x),randCoords(a.y,e[i],o.y),randCoords(a.z,e[i],o.z)),u=point(l.x+o.x*(e[i]-1),l.y+o.y*(e[i]-1),l.z+o.z*(e[i]-1))}while(checkInBetween(l,u,t,checkIfShipCell));r.push(buildShip(e[i],l,o,t,n))}return r},randomFleet=curry(generateRandomFleet),point=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:e,y:t,z:n}},tile=function(){return{point:{},styles:{width:"35px",height:"35px",backgroundColor:"transparent"},element:{}}},matrix=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return buildArray(buildArray(buildArray(e,t),n),r)},square=function(e,t){return matrix(e,t,t)},cube=function(e,t){return matrix(e,t,t,t)},tableHTML=function(){return[[{type:"table",class:"matrix"},{type:"tbody"}],{type:"tr",class:"row"},{type:"td",class:"column"}]},shipViewTile=function(){return{hasShip:!0,styles:{backgroundColor:"#777"}}},gameTile=function(){return{hasShip:!1,isHit:!1,styles:{border:"1px solid #333",backgroundColor:"white",cursor:"pointer"}}},waterTile=function(){return mergeObjects(tile(),gameTile(),{styles:{backgroundColor:"blue"}})},shipTile=function(){return{hasShip:!0}},ship=function(){return{status:100,parts:[]}},hitTile=function(){return{isHit:!0}},boardHTML=function(){return[[{type:"div",class:"matrix"}],{type:"div",class:"layer",styles:{display:"inline-block",position:"relative",margin:"0 auto"}},{type:"div",class:"row",styles:{display:"flex"}},{type:"div",class:"column",styles:{display:"inline-block"}}]},playerSet=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{name:e,status:100,turnCnt:0,attacker:!1,attacks:{hit:0,miss:0,sunk:0},board:{},shipFleet:[]}},defaultFleet=randomFleet([5,4,3,3,2]),configureHtml=function(e){return e.isHit&&(e.styles.backgroundColor=e.hasShip?"red":"white"),addElementStyles(e.element,e.styles),e},addElementStyles=function(e,t){return Object.keys(t).length&&e.style?Object.keys(t).forEach(function(n){return e.style[n]=t[n]}):e},generateElement=function(e){var t=document.createElement(e.type);return Object.keys(e).map(function(n){"type"!==n&&"styles"!==n&&t.setAttribute(n,e[n])}),e.styles&&addElementStyles(t,e.styles),t},recurseHtml=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=function(e){return nextIndex(t,e)};if(0===r){var o=function(){var o=[];Array.isArray(t[r])&&(o=t[r].map(generateElement)),n.forEach(function(n){return o[o.length-1].appendChild(e(t,n,i(r),a++))});var l=!1;return o.forEach(function(e){l&&l.appendChild(e),l=e}),{v:o[0]}}();if("object"===("undefined"==typeof o?"undefined":_typeof(o)))return o.v}if(1===r&&t.length>2&&(t[r].styles.zIndex=a),Array.isArray(n)){var l=function(){var o=generateElement(t[r]);return n.forEach(function(n){return o.appendChild(e(t,n,i(r),a))}),{v:o}}();if("object"===("undefined"==typeof l?"undefined":_typeof(l)))return l.v}var u=generateElement(t[r]);return n instanceof Object&&(n=configureHtml(mergeObjects(n,{element:u}))),u},processHtml=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body;return n.appendChild(recurseHtml(e,t))},generateHtml=curry(processHtml),createTable=generateHtml(boardHTML()),update3dCell=function(e,t,n,r,a){return configureHtml(mergeObjects(t[a][r][n],e))},alter3dCell=curry(update3dCell),setViewShip=alter3dCell(mergeObjects(shipTile(),{styles:{backgroundColor:"#777"}})),setHiddenShip=alter3dCell(shipTile()),setShip=function(e,t,n){return n?setViewShip(e,t.x,t.y,t.z):setHiddenShip(e,t.x,t.y,t.z)},setHit=alter3dCell(hitTile()),updatePlayer=function(e,t,n){e.attacker&&(t?++e.attacks.hit:++e.attacks.miss,n&&++e.attacks.sunk),t||(e.attacker=!e.attacker)},endGame=function(e){return[e]},nextAttacker=function(e,t,n,r,a,i){return r&&e.status>0?(updatePlayer(e,a,i),!r):e.attacker?(updatePlayer(e,a,i),t.length>1&&n>=t.length-1?(updatePlayer(t[0],a,i),r):!r):r},updateScore=function(e,t,n,r,a){e.status<=0&&a.push(e),r=r.filter(function(e){return e.status>0});var i=!1;return r.map(function(e,a){return i=nextAttacker(e,r,a,i,t,n),r.length<2?endGame(r[0]):e})},attackFleet=function(e,t,n,r,a){if(n.status<=0||n.attacker)return r;var i=setHit(t,e.x,e.y,e.z),o={};if(i.hasShip){var l=0;n.shipFleet.map(function(t){if(t.hasOwnProperty("parts")){var n=t.parts.filter(function(n){return n.point===e&&(o=t),!n.isHit});t.status=n.length/t.parts.length*100}return l+=t.status,t}),n.status=l/n.shipFleet.length}var u=o.status<=0?o.parts.length:0;return updateScore(n,i.hasShip,u,r,a)},launchAttack=curry(attackFleet);!function(){var e=[],t=function(t){for(var n=[],r=!0,a=0;a<t;++a){var i=playerSet();i.attacker=r,r=!1;var o=square(waterTile(),10);i.board=bindPointData(o),createTable(i.board,document.body),i.shipFleet=defaultFleet(i.board,!1),bindListeners(i.board,"click",launchAttack,i.board,i,n,e),n.push(i)}return n},n=t(2);console.log(n),console.log(e)}();
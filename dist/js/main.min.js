"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},curry=function(e){return function t(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return r.length>=e.length?e.apply(void 0,r):function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.apply(void 0,[].concat(r,n))}}},cloneObject=function(e){return JSON.parse(JSON.stringify(e))},mergeObjects=function e(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=n[0],o=n[1];n.length>2;){var i=n.splice(n.length-2,2);o=n[n.length-2]=e.apply(void 0,_toConsumableArray(i))}return"object"!==("undefined"==typeof a?"undefined":_typeof(a))||"object"!==("undefined"==typeof o?"undefined":_typeof(o))?"object"===("undefined"==typeof o?"undefined":_typeof(o))?o:a:(Object.keys(o).map(function(t){"object"===_typeof(o[t])&&a.hasOwnProperty(t)&&"object"===_typeof(a[t])&&(a[t]=e(a[t],o[t]),Object.keys(a[t]).length>Object.keys(o[t]).length&&(o[t]=cloneObject(a[t])))}),Object.assign(a,o))},fillArray=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return r=r.slice(),r.push(t),--n>0?e(cloneObject(t),n,r):r},buildArray=curry(fillArray),nextIndex=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t<e.length-1?++t:e.length-1},nextCell=function(e,t){return{x:e.x+t.x,y:e.y+t.y,z:e.z+t.z}},bindPointData=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"z";return Object.keys(n).length||(n=point(0,0,0)),Array.isArray(t)?t.map(function(t,a){return n=mergeObjects(n,_defineProperty({},r,a)),e(t,n,r)}):"object"!==("undefined"==typeof t?"undefined":_typeof(t))||t.point?(t.point=cloneObject(n),t):(Object.keys(t).map(function(r){return Array.isArray(t[r])?e(t[r],n,r):t[r]}),t)},addElementStyles=function(e,t){return Object.keys(t).length&&e.style?Object.keys(t).forEach(function(n){return e.style[n]=t[n]}):e},generateElement=function(e){var t=document.createElement(e.type);return Object.keys(e).map(function(n){"type"!==n&&"styles"!==n&&t.setAttribute(n,e[n])}),e.styles&&addElementStyles(t,e.styles),t},bindElements=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Array.isArray(n)?n.map(function(n,r){return"z"===n.axis?e(t,n,r):e(t,n,0)}):(n.element&&t[n.axis]&&(t[n.axis].styles=mergeObjects(n.styles,Array.isArray(t[n.axis])?t[n.axis][t[n.axis].length-1].styles:t[n.axis].styles),Array.isArray(t[n.axis])?t[n.axis][0].styles.zIndex=r:t[n.axis].styles.zIndex=r,n.element=Array.isArray(t[n.axis])?t[n.axis].map(function(e){return n.element instanceof HTMLElement?n.element.appendChild(generateElement(e)):n.element=generateElement(e)})[0]:generateElement(t[n.axis])),Object.keys(n).map(function(r){return Array.isArray(n[r])?e(t,n[r],0):n[r]}),n)},buildHTML=function e(t){return Array.isArray(t)?t.map(function(t){return e(t)}):(Object.keys(t).map(function(n){return Array.isArray(t[n])?e(t[n]).map(function(e){return t.element instanceof HTMLElement?t.element.appendChild(e):e}):t[n]}),t.element)},appendHTML=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;return t.appendChild(buildHTML(e))},checkInBetween=function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(a&&(r(e,n)||r(t,n)))return!0;var o=t.x-e.x,i=t.y-e.y,l=t.z-e.z;if(o>0){for(var s=e.x;s<t.x;++s)if(r({x:s,y:e.y,z:e.z},n))return!0}else if(i>0){for(var c=e.y;c<t.y;++c)if(r({x:e.x,y:c,z:e.z},n))return!0}else if(l>0)for(var u=e.z;u<t.z;++u)if(r({x:e.x,y:e.y,z:u},n))return!0;return!1},randCoords=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.floor(Math.random()*(e-(t-1)*n))},bindListeners=function e(t,n,r){for(var a=arguments.length,o=Array(a>3?a-3:0),i=3;i<a;i++)o[i-3]=arguments[i];return Array.isArray(t)?t.map(function(t){return e.apply(void 0,[t,n,r].concat(o))}):"object"!==("undefined"==typeof t?"undefined":_typeof(t))||t.point?t.element instanceof HTMLElement&&t.point?t.element.addEventListener(n,function(){return r.apply(void 0,[t.point].concat(o))}):t.element:(Object.keys(t).map(function(a){return Array.isArray(t[a])?e.apply(void 0,[t[a],n,r].concat(o)):t[a]}),t)},checkIfShipCell=function(e,t){return t.z[e.z].y[e.y].x[e.x].hasShip},checkIfHitCell=function(e,t){return t.z[e.z].y[e.y].x[e.x].isHit},buildShip=function(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=ship(),i=t,l=0;l<e;++l)o.parts.push(setShip(r,i,a)),i=nextCell(i,n);return o},generateRandomFleet=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],a={x:t.z[0].y[0].x.length,y:t.z[0].y.length,z:t.z.length};for(var o in e){var i=point(1,0,0),l=point(0,0,0),s=point(0,0,0),c=e[o]<=a.z?1:0;do{switch(Math.floor(Math.random()*(2+c))){case 0:i=point(1,0,0);break;case 1:i=point(0,1,0);break;default:i=point(0,0,1)}l=point(randCoords(a.x,e[o],i.x),randCoords(a.y,e[o],i.y),randCoords(a.z,e[o],i.z)),s=point(l.x+i.x*(e[o]-1),l.y+i.y*(e[o]-1),l.z+i.z*(e[o]-1))}while(checkInBetween(l,s,t,checkIfShipCell));r.push(buildShip(e[o],l,i,t,n))}return r},randomFleet=curry(generateRandomFleet),point=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:e,y:t,z:n}},tile=function(){return{point:{},styles:{width:"35px",height:"35px",backgroundColor:"transparent"},element:{}}},coordinate=function(e){return{axis:e,element:{}}},matrix=function(e,t,n){for(var r=arguments.length,a=Array(r>4?r-4:0),o=4;o<r;o++)a[o-4]=arguments[o];var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return mergeObjects.apply(void 0,[coordinate("base"),{z:buildArray(mergeObjects.apply(void 0,[coordinate("z"),{y:buildArray(mergeObjects.apply(void 0,[coordinate("y"),{x:buildArray(mergeObjects.apply(void 0,[coordinate("x"),e].concat(a)),t)}].concat(a)),n)}].concat(a)),i)}].concat(a))},square=function(e,t){return matrix(e,t,t)},cube=function(e,t){return matrix(e,t,t,t)},tableHTML=function(){return{base:[{type:"table",class:"matrix"}],z:{type:"tbody"},y:{type:"tr",class:"row"},x:{type:"td",class:"column"}}},gameTile=function(){return{hasShip:!1,isHit:!1,styles:{border:"1px solid #333",backgroundColor:"white",cursor:"pointer"}}},waterTile=function(){return mergeObjects(tile(),gameTile(),{styles:{backgroundColor:"blue"}})},shipTile=function(){return{hasShip:!0}},ship=function(){return{status:100,parts:[]}},hitTile=function(){return{isHit:!0}},boardHTML=function(){return{base:[{type:"div",class:"matrix",styles:{}}],z:{type:"div",class:"layer",styles:{display:"inline-block",position:"relative",margin:"0 auto"}},y:{type:"div",class:"row",styles:{display:"flex"}},x:{type:"div",class:"column",styles:{display:"inline-block"}}}},playerSet=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{name:e,isRobot:!1,status:100,turnCnt:0,attacker:!1,attacks:{hit:0,miss:0,sunk:0},board:{},shipFleet:[]}},defaultFleet=randomFleet([5,4,3,3,2]),selectTargetPlayer=function(e){return 1===e.length?e[0]:e[Math.floor(Math.random()*e.length)]},selectTargetCoord=function(e,t){var n={x:e.z[0].y[0].x.length,y:e.z[0].y.length,z:e.z.length};point(0,0,0);return point(randCoords(n.x),randCoords(n.y),randCoords(n.z))},computerAttack=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=selectTargetPlayer(t.filter(function(e){return!e.attacker}));console.log("Victim:"),console.log(a);var o=selectTargetCoord(a.board,r);console.log("Target:"),console.log(o),attackFleet(o,a.board,a,t,n)},configureHtml=function(e){return e.isHit&&(e.styles.backgroundColor=e.hasShip?"red":"white"),addElementStyles(e.element,e.styles),e},update3dCell=function(e,t,n,r,a){return configureHtml(mergeObjects(t.z[a].y[r].x[n],e))},alter3dCell=curry(update3dCell),setViewShip=alter3dCell(mergeObjects(shipTile(),{styles:{backgroundColor:"#777"}})),setHiddenShip=alter3dCell(shipTile()),setShip=function(e,t,n){return n?setViewShip(e,t.x,t.y,t.z):setHiddenShip(e,t.x,t.y,t.z)},setHit=alter3dCell(hitTile()),updatePlayer=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.attacker&&(t?++e.attacks.hit:++e.attacks.miss,n&&++e.attacks.sunk),t||(e.attacker=!e.attacker),e},endGame=function(e){return[e]},getNextAttacker=function(e,t,n){var r=t.indexOf(e),a={};do a=t.length>1&&r>=t.length-1?t[0]:t[++r];while(a.status<=0);return n?e:updatePlayer(a,n)},updateScore=function(e,t,n,r,a,o){e.status<=0&&a.push(e),r=r.filter(function(e){return e.status>0});var i=r.reduce(function(e,t){return e.attacker?e:t});if(console.log("Attacker:"),console.log(i),i=updatePlayer(i,t,n),r.length<2)return endGame(r[0]);var l=getNextAttacker(i,r,t);return console.log("Next Attacker:"),console.log(l),l.isRobot&&computerAttack(l,r,a,!!t&&o),r},attackFleet=function(e,t,n,r,a){if(n.status<=0||n.attacker)return r;var o=setHit(t,e.x,e.y,e.z),i={};if(o.hasShip){var l=0;n.shipFleet.map(function(t){if(t.hasOwnProperty("parts")){var n=t.parts.filter(function(n){return n.point===e&&(i=t),!n.isHit});t.status=n.length/t.parts.length*100}return l+=t.status,t}),n.status=l/n.shipFleet.length}var s=i.status<=0?i.parts.length:0;return updateScore(n,o.hasShip,s,r,a,e)},launchAttack=curry(attackFleet);!function(){var e=[],t=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=[],a=!0,o=t+n;o<2&&(o=2);for(var i=0;i<o;++i){var l=playerSet();l.attacker=a,l.isRobot=--t<0,a=!1;var s=square(waterTile(),10);s=bindPointData(s),s=bindElements(boardHTML(),s),l.board=s;appendHTML(l.board);l.shipFleet=defaultFleet(l.board,!0),bindListeners(l.board,"click",launchAttack,l.board,l,r,e),r.push(l)}return r},n=t(1);console.log(n),console.log(e)}();